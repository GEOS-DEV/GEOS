<?xml version="1.0" ?>
<!--# # -->

<Problem xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="geos_v0.0.xsd">

  
  <Solvers>
    <SolidMechanics_LagrangianFEM name="lagsolve" 
                                  courant="0.25"/>
  </Solvers>

  
  <Mesh>
    <InternalMesh name="mesh1"
                  elementTypes="C3D8" 
                  xCoords="0, 2"
                  yCoords="0, 2"
                  zCoords="0, 2"
                  nx="20"
                  ny="20"
                  nz="20"
                  cellBlockNames="cb1"/>
  </Mesh>


  <Events maxTime="2.0e-4"
          maxCycle="30"
          verbosity="1">

    <!-- The default is to execute an event every cycle.  If forceDt is not specified, each event will
         ask it's target for its desired time step (the next cycle will use the lowest value) -->
    <PeriodicEvent name="solverApplications"
                   forceDt="1.0e-5"
                   target="/Solvers/lagsolve"/>

    
    <!-- The targetExactTimestep parameter instructs the event 
         to target an integer multiple of the timeFrequency -->
    <PeriodicEvent name="outputs_group"
                   timeFrequency="1.23456789e-4"
                   targetExactTimestep="1"
                   target="/Outputs/siloOutput" />


    <!-- Periodic events have an optional function input, which is evaluated when the forecast reaches 0-->
    <PeriodicEvent name="outputs_c"
                   cycleFrequency="2"
                   function="blueprintTriggerFunction"
                   threshold="0.9"
                   target="/Outputs/blueprintOutput" />


    <!-- If the function looks at field data (pressure, etc.), then you also need to specify a target object,
         an optional setname, and the field statistic you are interested in (0=min, 1=avg, 2-max)-->
    <!-- <PeriodicEvent name="outputs_c"
                   function="spaceFunction"
                   threshold="0.9"
                   object="/path/to/object"
                   set="setname"
                   stat="2"
                   target="/Outputs/blueprintOutput" /> -->


    <!-- Events can be nested -->
    <!-- <PeriodicEvent name="outputs_group" cycleFrequency="5">
      <PeriodicEvent name="outputs_a"
                     target="/Outputs/siloOutput" />

      <PeriodicEvent name="outputs_b"
                     target="/Outputs/blueprintOutput" />
    </PeriodicEvent> -->


    <!-- Halt events look at the run-time, and allow you to exit gracefully -->
    <HaltEvent name="outputs_c"
               maxRuntime="100"
               target="/Outputs/restartOutput" />
  </Events>



  <NumericalMethods>

    <BasisFunctions>
        <LagrangeBasis3 name="linearBasis"  degree = "1"  />
    </BasisFunctions>
    
    <QuadratureRules>
        <GaussQuadrature3 name="gaussian"   degree="2"  />    
    </QuadratureRules>
    
    <FiniteElements>
        <finiteElementSpace name="FE1" basis="linearBasis" quadrature="gaussian" />
    </FiniteElements>
  </NumericalMethods>

  <ElementRegions>
    <!-- ElementRegion name="Region1" cellBlocks="cb1"     numericalMethod="FE1" material="granite"/-->
    <ElementRegion name="Region2" cellBlocks="cb1" numericalMethod="FE1" material="shale" />
  </ElementRegions>

  <Constitutive>
      <LinearElasticIsotropic name="granite">
        <ParameterData Density="2700"
                       BulkModulus="5.5556e9"
                       ShearModulus="4.16667e9"/>
      </LinearElasticIsotropic>
      <LinearElasticIsotropic name="shale">
        <ParameterData Density="2700"
                       BulkModulus="5.5556e9"
                       ShearModulus="4.16667e9"/>
      </LinearElasticIsotropic>
      <LinearElasticIsotropic name="water">
        <ParameterData Density="1000"
                              BulkModulus="2.0e9"
                              ShearModulus="0.0"/>
      </LinearElasticIsotropic>
  </Constitutive>


  <InitialConditions>
    
  </InitialConditions>

  <FieldSpecifications>
    <FieldSpecification name="source"  
               initialCondition="1"  
               elementRegionName="Region2" 
               setNames="source"
               fieldName="ConstitutiveManager/shale/StateData/MeanStress"
               dataType="real64" 
               scale="-1.0e6"
               function="spaceFunction"/>

    <!--FieldSpecification name="v0"          component="0" fieldName="Velocity"          dataType="Vector" functionName="timeFunction" object="Node" scale="1.0" setNames="xneg"/-->
    <FieldSpecification name="xconstraint" component="0" fieldName="Velocity" dataType="Vector" object="Node" scale="0.0" setNames="xneg xpos"/>
    <FieldSpecification name="yconstraint" component="1" fieldName="Velocity" dataType="Vector" object="Node" scale="0.0" setNames="yneg ypos"/>
    <FieldSpecification name="zconstraint" component="2" fieldName="Velocity" dataType="Vector" object="Node" scale="0.0" setNames="zneg zpos"/>
  </FieldSpecifications>


  <Functions>
    <TableFunction     name="timeFunction"         inputVarNames="time"  inputVarTypes="" coordinates="0.0 1.0e-6 2.0e-6 1.0e9" values="0.0 1.0 1.0 1.0" />

    <TableFunction name="blueprintTriggerFunction"               inputVarNames="time"
                   inputVarTypes=""
                   coordinates="0.0 2.0e-4"
                   values="0.0 1.0" />

    <SymbolicFunction  name="spaceFunction"        inputVarNames="ReferencePosition" inputVarTypes=""  variableNames="x y z" expression="sqrt(pow(x,2)+pow(y,2)+pow(z,2))"/>
    <!--CompositeFunction name="timeSpaceFunction" variableNames="timeTable1 spaceFunction" expression="timeTable1*spaceFunction"/-->
  </Functions>

  <Partition>
    <SpatialPartition xPar="1" yPar="1" zPar="1"/>
  </Partition>

 
  <Outputs>
    <Silo name="siloOutput" parallelThreads="1" plotFileRoot="plot" slaveDirectory="sub" writeFEMEdges="0" writeFEMFaces="1"/>

    <Blueprint name="blueprintOutput" parallelThreads="1"/>

    <Restart name="restartOutput" parallelThreads="1"/>
  </Outputs>
  

  <Geometry>
    <Box name="source" type="0" xMin="-1, -1, -1" xMax="1.1, 1.1, 1.1"/>
  </Geometry>


  <Fracture failCriterion="1" failGap="0.0004" fractureFlag="100" preFractureSetName="perf" rockToughness="1e6" separableSet="all"/>

</Problem>
