<?xml version="1.0" ?>

<Problem>
  <Solvers>
    <!-- define the solver, source coordinates, time source frequency, receiver coordinates -->
    <AcousticSEM
      name="acousticSolver"
      discretization="FE1"
      targetRegions="{ Fluid }"
      sourceCoordinates="{ { 1575, 1200, 2900 } }"
      timeSourceFrequency="10"
      timeSourceDelay="0.115"
      rickerOrder="3"
      outputSeismoTrace="1"
      dtSeismoTrace="1e-3"
      receiverCoordinates="{ { 2500.0000, 1200, 2933.3333 },
                             { 2532.1101, 1200, 2933.3333 },
                             { 2564.2202, 1200, 2933.3333 },
                             { 2596.3303, 1200, 2933.3333 },
                             { 2628.4404, 1200, 2933.3333 },
                             { 2660.5505, 1200, 2933.3333 },
                             { 2692.6606, 1200, 2933.3333 },
                             { 2724.7706, 1200, 2933.3333 },
                             { 2756.8807, 1200, 2933.3333 },
                             { 2788.9908, 1200, 2933.3333 },
                             { 2821.1009, 1200, 2933.3333 },
                             { 2853.2110, 1200, 2933.3333 },
                             { 2885.3211, 1200, 2933.3333 },
                             { 2917.4312, 1200, 2933.3333 },
                             { 2949.5413, 1200, 2933.3333 },
                             { 2981.6514, 1200, 2933.3333 },
                             { 3013.7615, 1200, 2933.3333 },
                             { 3045.8716, 1200, 2933.3333 },
                             { 3077.9817, 1200, 2933.3333 },
                             { 3110.0917, 1200, 2933.3333 },
                             { 3142.2018, 1200, 2933.3333 },
                             { 3174.3119, 1200, 2933.3333 },
                             { 3206.4220, 1200, 2933.3333 },
                             { 3238.5321, 1200, 2933.3333 },
                             { 3270.6422, 1200, 2933.3333 },
                             { 3302.7523, 1200, 2933.3333 },
                             { 3334.8624, 1200, 2933.3333 },
                             { 3366.9725, 1200, 2933.3333 },
                             { 3399.0826, 1200, 2933.3333 },
                             { 3431.1927, 1200, 2933.3333 },
                             { 3463.3028, 1200, 2933.3333 },
                             { 3495.4128, 1200, 2933.3333 },
                             { 3527.5229, 1200, 2933.3333 },
                             { 3559.6330, 1200, 2933.3333 },
                             { 3591.7431, 1200, 2933.3333 },
                             { 3623.8532, 1200, 2933.3333 },
                             { 3655.9633, 1200, 2933.3333 },
                             { 3688.0734, 1200, 2933.3333 },
                             { 3720.1835, 1200, 2933.3333 },
                             { 3752.2936, 1200, 2933.3333 } }"/>
    <ElasticSEM
      name="elasticSolver"
      discretization="FE1"
      targetRegions="{ Solid }"
      sourceCoordinates="{ }"
      timeSourceFrequency="0"
      outputSeismoTrace="1"
      dtSeismoTrace="1e-3"
      receiverCoordinates="{ { 2500.0000, 1200, 1866.6667 },
                             { 2532.1101, 1200, 1866.6667 },
                             { 2564.2202, 1200, 1866.6667 },
                             { 2596.3303, 1200, 1866.6667 },
                             { 2628.4404, 1200, 1866.6667 },
                             { 2660.5505, 1200, 1866.6667 },
                             { 2692.6606, 1200, 1866.6667 },
                             { 2724.7706, 1200, 1866.6667 },
                             { 2756.8807, 1200, 1866.6667 },
                             { 2788.9908, 1200, 1866.6667 },
                             { 2821.1009, 1200, 1866.6667 },
                             { 2853.2110, 1200, 1866.6667 },
                             { 2885.3211, 1200, 1866.6667 },
                             { 2917.4312, 1200, 1866.6667 },
                             { 2949.5413, 1200, 1866.6667 },
                             { 2981.6514, 1200, 1866.6667 },
                             { 3013.7615, 1200, 1866.6667 },
                             { 3045.8716, 1200, 1866.6667 },
                             { 3077.9817, 1200, 1866.6667 },
                             { 3110.0917, 1200, 1866.6667 },
                             { 3142.2018, 1200, 1866.6667 },
                             { 3174.3119, 1200, 1866.6667 },
                             { 3206.4220, 1200, 1866.6667 },
                             { 3238.5321, 1200, 1866.6667 },
                             { 3270.6422, 1200, 1866.6667 },
                             { 3302.7523, 1200, 1866.6667 },
                             { 3334.8624, 1200, 1866.6667 },
                             { 3366.9725, 1200, 1866.6667 },
                             { 3399.0826, 1200, 1866.6667 },
                             { 3431.1927, 1200, 1866.6667 },
                             { 3463.3028, 1200, 1866.6667 },
                             { 3495.4128, 1200, 1866.6667 },
                             { 3527.5229, 1200, 1866.6667 },
                             { 3559.6330, 1200, 1866.6667 },
                             { 3591.7431, 1200, 1866.6667 },
                             { 3623.8532, 1200, 1866.6667 },
                             { 3655.9633, 1200, 1866.6667 },
                             { 3688.0734, 1200, 1866.6667 },
                             { 3720.1835, 1200, 1866.6667 },
                             { 3752.2936, 1200, 1866.6667 } }"/>
    <!-- NOTES:
      - coupled solver must be declared at the end (for interface computations)
      - discretization is also needed for the correct mesh to be passed through from the coupled solver to the elastic / acoustic solvers
    -->
    <AcousticElasticSEM
      name="acousticelasticSolver"
      discretization="FE1"
      targetRegions="{ Solid, Fluid }"
      acousticSolverName="acousticSolver"
      elasticSolverName="elasticSolver"/>
  </Solvers>

  <!--
  hexahedral mesh generated internally by GEOSX
  6400x1600x4800m domain
  # R1-Q5 (pseudo-2D)
  sourceCoordinates="{ { 1500, 20, 2900  } }"
  yCoords="{ 0, 40 }"
  nx="{ 160 }"
  ny="{ 1 }"
  nz="{ 60, 60 }"
  # R2-Q2 (pseudo-2D)
  sourceCoordinates="{ { 1500, 10, 2900  } }"
  yCoords="{ 0, 20 }"
  nx="{ 320 }"
  ny="{ 1 }"
  nz="{ 120, 120 }"
  # R5-Q1 (pseudo-2D)
  sourceCoordinates="{ { 1500, 4, 2900  } }"
  yCoords="{ 0, 8 }"
  nx="{ 800 }"
  ny="{ 1 }"
  nz="{ 300, 300 }"
  NOTES:
    nx="{ 320 }"
    ny="{ 120 }"
    nz="{ 120, 120 }
    => local threshold for local builds in 3D Q1 (9e6 elems, 5Gb GPU)
    or
    nx="{ 160 }"
    ny="{ 60 }"
    nz="{ 60, 60 }
    => local threshold for local builds in 3D Q2 (1e6 elems, 2Gb GPU)
  -->
  <Mesh>
    <InternalMesh
      name="mesh"
      elementTypes="{ C3D8 }"
      xCoords="{ 0, 6400 }"
      yCoords="{ 0, 2400 }"
      zCoords="{ 0, 2400, 4800 }"
      nx="{ 320 }"
      ny="{ 120 }"
      nz="{ 120, 120 }"
      cellBlockNames="{ solid, fluid }"/>
  </Mesh>

  <NumericalMethods>
    <FiniteElements>
      <FiniteElementSpace
        name="FE1"
        order="3"
        formulation="SEM"/>
    </FiniteElements>
  </NumericalMethods>

  <Events
    maxTime="3">
    <PeriodicEvent
      name="outputs"
      timeFrequency="3.1"
      targetExactTimestep="0">
      <PeriodicEvent name="outputs_vtk" target="/Outputs/vtkOutput"/>
      <!--
      <PeriodicEvent name="tsk_ux_np1" target="/Tasks/displacementxCollection"/>
      <PeriodicEvent name="out_ux_np1" target="/Outputs/timeHistoryOutputx"/>
      <PeriodicEvent name="tsk_uy_np1" target="/Tasks/displacementyCollection"/>
      <PeriodicEvent name="out_uy_np1" target="/Outputs/timeHistoryOutputy"/>
      <PeriodicEvent name="tsk_uz_np1" target="/Tasks/displacementzCollection"/>
      <PeriodicEvent name="out_uz_np1" target="/Outputs/timeHistoryOutputz"/>
      <PeriodicEvent name="tsk_p_np1" target="/Tasks/pressureCollection"/>
      <PeriodicEvent name="out_p_np1" target="/Outputs/timeHistoryOutput"/>
      -->
    </PeriodicEvent>
    <!-- control the timestepping here with forceDt -->
    <PeriodicEvent
      name="solidfluidSolverApplications"
      forceDt="1e-4"
      target="/Solvers/acousticelasticSolver"/>
    <!-- FIXME: forceDt hack to satisfy pre-timeloop computation -->
    <SoloEvent
      name="solidSolverApplications"
      forceDt="1e-4"
      endTime="0"
      target="/Solvers/elasticSolver"/>
    <SoloEvent
      name="fluidSolverApplications"
      forceDt="1e-4"
      endTime="0"
      target="/Solvers/acousticSolver"/>
  </Events>

  <ElementRegions>
    <CellElementRegion
      name="Fluid"
      cellBlocks="{ fluid }"
      materialList="{ nullModel }"/>
    <CellElementRegion
      name="Solid"
      cellBlocks="{ solid }"
      materialList="{ nullModel }"/>
  </ElementRegions>

  <Constitutive>
    <NullModel
      name="nullModel"/>
  </Constitutive>

  <FieldSpecifications>
    <!-- initial condition for ρ, 𝓋ₚ and 𝓋ₛ -->
    <FieldSpecification
      name="acousticVelocity"
      initialCondition="1"
      objectPath="mesh/FE1/ElementRegions/Fluid/fluid"
      fieldName="mediumVelocity"
      scale="1500.0"
      setNames="{ all }"/>
    <FieldSpecification
      name="acousticDensity"
      initialCondition="1"
      objectPath="mesh/FE1/ElementRegions/Fluid/fluid"
      fieldName="mediumDensityA"
      scale="1020.0"
      setNames="{ all }"/>
    <FieldSpecification
      name="elasticVelocityVp"
      initialCondition="1"
      objectPath="mesh/FE1/ElementRegions/Solid/solid"
      fieldName="mediumVelocityVp"
      scale="3400.0"
      setNames="{ all }"/>
    <FieldSpecification
      name="elasticVelocityVs"
      initialCondition="1"
      objectPath="mesh/FE1/ElementRegions/Solid/solid"
      fieldName="mediumVelocityVs"
      scale="1963.0"
      setNames="{ all }"/>
    <FieldSpecification
      name="elasticDensity"
      initialCondition="1"
      objectPath="mesh/FE1/ElementRegions/Solid/solid"
      fieldName="mediumDensityE"
      scale="2500.0"
      setNames="{ all }"/>
  </FieldSpecifications>

  <Tasks>
    <PackCollection
      name="pressureCollection"
      objectPath="mesh/FE1/nodeManager"
      fieldName="pressure_np1"/>
    <PackCollection
      name="displacementxCollection"
      objectPath="mesh/FE1/nodeManager"
      fieldName="displacementx_np1"/>
    <PackCollection
      disableCoordCollection="1"
      name="displacementyCollection"
      objectPath="mesh/FE1/nodeManager"
      fieldName="displacementy_np1"/>
    <PackCollection
      disableCoordCollection="1"
      name="displacementzCollection"
      objectPath="mesh/FE1/nodeManager"
      fieldName="displacementz_np1"/>
  </Tasks>

  <Outputs>
    <VTK
      name="vtkOutput"
      plotLevel="0"/>
    <TimeHistory
      name="timeHistoryOutput"
      sources="{ /Tasks/pressureCollection }"
      filename="pressure_history"/>
    <TimeHistory
      name="timeHistoryOutputx"
      sources="{ /Tasks/displacementxCollection }"
      filename="displacementx_history"/>
    <TimeHistory
      name="timeHistoryOutputy"
      sources="{ /Tasks/displacementyCollection }"
      filename="displacementy_history"/>
    <TimeHistory
      name="timeHistoryOutputz"
      sources="{ /Tasks/displacementzCollection }"
      filename="displacementz_history"/>
  </Outputs>
</Problem>
