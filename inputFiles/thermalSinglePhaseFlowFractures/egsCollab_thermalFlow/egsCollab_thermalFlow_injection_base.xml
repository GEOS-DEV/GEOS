<?xml version="1.0" ?>

<Problem>
  <Solvers
    gravityVector="{ 0.0, 0.0, -9.81 }">
    <SinglePhaseFVM
      name="singleFlow"
      logLevel="1"
      discretization="singlePhaseTPFA"
      isThermal="1"
      targetRegions="{ matrix, fracture }">
      <NonlinearSolverParameters
        newtonTol="1.0e-4"
        newtonMaxIter="25"
        maxAllowedResidualNorm="1e25"
        lineSearchAction="None"/>
      <LinearSolverParameters
        directParallel="0"/>
    </SinglePhaseFVM>

     <EmbeddedSurfaceGenerator
      name="SurfaceGenerator"
      discretization="FE1"
      targetRegions="{ matrix }"
      fractureRegion="fracture"
      logLevel="1"
      mpiCommOrder="1"/>
  </Solvers>

  <NumericalMethods>
    <FiniteVolume>
      <TwoPointFluxApproximation
        name="singlePhaseTPFA"/>
    </FiniteVolume>
     <FiniteElements>
      <FiniteElementSpace
        name="FE1"
        order="1"/>
    </FiniteElements>
  </NumericalMethods>

  <ElementRegions>
    <CellElementRegion
      name="matrix"
      cellBlocks="{ cb }"
      materialList="{ water, rock, thermalCond }"/>

    <SurfaceElementRegion
      name="fracture"
      subRegionType="embeddedElement"
      materialList="{ water, fractureContact, fractureFilling, thermalCond }"
      defaultAperture="1e-4"/>  
  </ElementRegions>

  <Events
     maxTime="7.884e10">
     <SoloEvent
     name="preFracture"
     target="/Solvers/SurfaceGenerator"/>

     <PeriodicEvent
       name="solverApplications0"
       forceDt="0.01"
       beginTime="0.00"
       endTime="0.01"
       target="/Solvers/singleFlow"/>

     <PeriodicEvent
       name="solverApplications1"
       forceDt="7.884e9"
       target="/Solvers/singleFlow"/>

     <PeriodicEvent
       name="outputs"
       cycleFrequency="1"
       target="/Outputs/vtkOutput"/>
   </Events>

  <Geometry>
    <Box
    name="bottomBoundary"
    xMin="{ -0.01, -0.01, -0.01 }"
    xMax="{ 200, 200, 0.75 }"/>
    <Cylinder
    name="Drift"
    firstFaceCenter="{ 73.425, -0.1, 72 }"
    secondFaceCenter="{ 73.425, 75, 72 }"
    outerRadius="4"/>
    <!-- <BoundedPlane 
    name="FracturePlane" 
    normal="{0.296198132726024,0.813797681349374,-0.5}" 
    origin="{40.0, 37.5,10.}" 
    lengthVector="{0.860365606244012,-0.0, 0.50967737206234}"
    widthVector="{0.414774263620574,-0.581148289019578,-0.700163535474126}"
    dimensions="{80, 300}"/> -->
    <BoundedPlane
    name="FracturePlane2"
    normal="{ 0.3569123763, 0.9123044601, 0.2007837838 }"
    origin="{ 100.0000000000, 37.5000000000, 30.0000000000 }"
    lengthVector="{ -0.4902994003, 0.0000000000, 0.8715540706 }"
    widthVector="{ 0.7951226658, -0.4095126032, 0.4473023297 }"
    dimensions="{ 100, 80 }"/>
  </Geometry>

  <Constitutive>
     <ThermalCompressibleSinglePhaseFluid
       name="water"
       defaultDensity="1000"
       defaultViscosity="0.001"
       referencePressure="1.0e5"
       referenceTemperature="273.0"
       compressibility="0.0"
       thermalExpansionCoeff="0.0"
       viscosibility="0.0"
       volumetricHeatCapacity="4.0e3"
       referenceInternalEnergy="0.99"/>

     <SinglePhaseConstantThermalConductivity
       name="thermalCond"
       thermalConductivityComponents="{ 3.81, 3.81, 3.81 }"/>  

     <CompressibleSolidParallelPlatesPermeability
       name="fractureFilling"
       solidModelName="nullSolid"
       porosityModelName="fracturePorosity"
       permeabilityModelName="fracturePerm"
       solidInternalEnergyModelName="rockInternalEnergy"/>

     <CompressibleSolidConstantPermeability
       name="rock"
       solidModelName="nullSolid"
       porosityModelName="rockPorosity"
       permeabilityModelName="rockPerm"
       solidInternalEnergyModelName="rockInternalEnergy"/>

     <SolidInternalEnergy
       name="rockInternalEnergy"
       volumetricHeatCapacity="2.3345e6"
       referenceTemperature="0"
       referenceInternalEnergy="0"/>  

     <NullModel
       name="nullSolid"/>

     <PressurePorosity
       name="rockPorosity"
       defaultReferencePorosity="0.01"
       referencePressure="0.0"
       compressibility="0.0"/>

     <ConstantPermeability
       name="rockPerm"
       permeabilityComponents="{ 1.0e-20, 1.0e-20, 1.0e-20 }"/>

     <PressurePorosity
       name="fracturePorosity"
       defaultReferencePorosity="1.00"
       referencePressure="0.0"
       compressibility="7.2e-16"/>

     <ParallelPlatesPermeability
       name="fracturePerm"/>

     <FrictionlessContact
      name="fractureContact"
      penaltyStiffness="0.0e8"
      apertureTableName="apertureTable"/>  
   </Constitutive>

  <FieldSpecifications>
    <FieldSpecification
       name="matrixPorosity"
       initialCondition="1"
       setNames="{ all }"
       objectPath="ElementRegions/matrix"
       fieldName="rockPorosity_referencePorosity"
       scale="0.01"/>

     <FieldSpecification
       name="fracPorosity"
       initialCondition="1"
       setNames="{ all }"
       objectPath="ElementRegions/fracture"
       fieldName="fracturePorosity_referencePorosity"
       scale="1.0"/>   

    <FieldSpecification
      name="initialPressure"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions"
      fieldName="pressure"
      scale="2e6"/>

    <FieldSpecification
      name="initialTemperature"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions"
      fieldName="temperature"
      functionName="temperatureField"
      scale="1"/>

    <FieldSpecification
      name="topPressure"
      objectPath="faceManager"
      fieldName="pressure"
      scale="2e6"
      setNames="{ zpos }"
      logLevel="0"/>

    <FieldSpecification
      name="topTemperature"
      objectPath="faceManager"
      fieldName="temperature"
      scale="296.0153"
      setNames="{ zpos }"
      logLevel="0"/>   

    <FieldSpecification
      name="botTemperature"
      objectPath="ElementRegions/matrix"
      fieldName="temperature"
      scale="303.012"
      setNames="{ bottomBoundary }"/> 
      
    <FieldSpecification
      name="DriftTemperature"
      objectPath="ElementRegions/matrix"
      fieldName="temperature"
      scale="291.65"
      setNames="{ Drift }"/>   
      
    <!-- <SourceFlux
      name="sourceTerm"
      objectPath="ElementRegions/matrix/cb"
      scale="-0.00001"
      setNames="{ source }"/> -->
  </FieldSpecifications>

  <Functions>
    <TableFunction
      name="temperatureField"
      inputVarNames="{ elementCenter }"
      coordinateFiles="{ bc_data/xlin.geos, bc_data/ylin.geos, bc_data/zlin.geos }"
      voxelFile="bc_data/temp.geos"
      interpolation="linear"/>

    <TableFunction
      name="apertureTable"
      coordinates="{ -1.0e-3, 0.0 }"
      values="{ 1.0e-6, 1.0e-4 }"/>  
  </Functions>

  <Outputs>
    <VTK
      name="vtkOutput"
      plotFileRoot="thermalFlowFrac_collab"/>
  </Outputs>
</Problem>
