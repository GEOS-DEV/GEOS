<?xml version="1.0" ?>
<Problem>

  <Solvers
    gravityVector="{ 0.0, 0.0, 0.0 }">
    <LagrangianContact
      name="lagrangiancontact"
      solidSolverName="lagsolve"
      stabilizationName="TPFAstabilization"
      discretization="FE1"
      targetRegions="{ casing, cement, rock, Fracture }"
      contactRelationName="fractureContact"
      fractureRegionName="Fracture"
      logLevel="1">
      <NonlinearSolverParameters
        newtonTol="1.0e-6"
        logLevel="2"
        newtonMaxIter="10"
        />
      <LinearSolverParameters
        directParallel="0"/>
    </LagrangianContact>

    <SolidMechanicsLagrangianSSLE
      name="lagsolve"
      timeIntegrationOption="QuasiStatic"
      discretization="FE1"
      targetRegions="{ casing, cement, rock }">
      <NonlinearSolverParameters
        newtonTol="1.0e-6"/>
      <LinearSolverParameters
        krylovTol="1.0e-10"/>
    </SolidMechanicsLagrangianSSLE>

    <SurfaceGenerator
      name="SurfaceGen"
      fractureRegion="Fracture"
      targetRegions="{ casing, cement, rock }"
      rockToughness="1.0e6"
      mpiCommOrder="1"/>

  </Solvers>

  <!-- SPHINX_FEDiscretization -->
  <NumericalMethods>
    <FiniteElements>
      <FiniteElementSpace
        name="FE1"
        order="1"/>
    </FiniteElements>
  
    <FiniteVolume>
      <TwoPointFluxApproximation
        name="TPFAstabilization"/>
    </FiniteVolume>
  </NumericalMethods>
  <!-- SPHINX_FEDiscretizationEnd -->

  <ElementRegions>
    <SurfaceElementRegion
      name="Fracture"
      defaultAperture="0.001"
      materialList="{ fractureContact }"/>

    <CellElementRegion
      name="casing"
      cellBlocks="{ casing }"
      materialList="{ casing }"/>
      
    <CellElementRegion
      name="cement"
      cellBlocks="{ cement }"
      materialList="{ cement }"/>

    <CellElementRegion
      name="rock"
      cellBlocks="{ rock }"
      materialList="{ rock }"/>
      
  </ElementRegions>

  <Constitutive>
    <!-- SPHINX_Material -->
    <Coulomb
      name="fractureContact"
      cohesion="0"
      frictionCoefficient="0.5"
      penaltyStiffness="1.0e8"
      apertureTableName="apertureTable"/>

    <ElasticIsotropic
      name="casing"
      defaultDensity="2700"
      defaultBulkModulus="175e9"
      defaultShearModulus="80.8e9"/>

    <ElasticIsotropic
      name="cement"
      defaultDensity="2700"
      defaultBulkModulus="10.3e9"
      defaultShearModulus="6.45e9"/>

    <ElasticIsotropic
      name="rock"
      defaultDensity="2700"
      defaultBulkModulus="5.5556e9"
      defaultShearModulus="4.16667e9"/>

    <!-- SPHINX_MaterialEnd -->
  </Constitutive>

  <!-- SPHINX_BoundaryConditions -->
  <FieldSpecifications>
    <FieldSpecification
      name="frac"
      initialCondition="1"
      setNames="{ casingCementInterface, cementRockInterface }"
      objectPath="faceManager"
      fieldName="ruptureState"
      scale="1"/>

    <FieldSpecification
      name="separableFace"
      initialCondition="1"
      setNames="{ casingCementInterface, cementRockInterface }"
      objectPath="faceManager"
      fieldName="isFaceSeparable"
      scale="1"/>

    <FieldSpecification
      name="rPosConstraint_x"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="0"
      scale="0.0"
      setNames="{ rpos }"/>

    <FieldSpecification
      name="rPosConstraint_y"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="1"
      scale="0.0"
      setNames="{ rpos }"/>

    <FieldSpecification
      name="tNegConstraint"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="1"
      scale="0.0"
      setNames="{ tneg }"/>

   <FieldSpecification
      name="tPosConstraint"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="0"
      scale="0.0"
      setNames="{ tpos }"/>

    <FieldSpecification
      name="zconstraint"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="2"
      scale="0.0"
      setNames="{ zneg, zpos }"/>

    <Traction
      name="innerPressure"
      objectPath="faceManager"
      tractionType="normal"
      scale="10.0e6"
      functionName="ForceTimeFunction"
      setNames="{ rneg }"/>

  </FieldSpecifications>

  <!-- SPHINX_BoundaryConditionsEnd -->

  <!-- SPHINX_TableFunction -->
  <Functions>
    <TableFunction
      name="ForceTimeFunction"
      inputVarNames="{ time }"
      coordinates="{ 0.0, 0.5, 1.0 }"
      values="{ 0.0, -1.0, 1.0 }"/>
    <TableFunction
      name="apertureTable"
      coordinates="{ -1.0e-3, 0.0 }"
      values="{ 1e-4, 1e-3 }"/> 
  </Functions>
  <!-- SPHINX_TableFunctionEnd -->

  <Tasks>

    <PackCollection
      name="stressCollection_casing"
      objectPath="ElementRegions/casing/casing"
      fieldName="casing_stress"/>
    <PackCollection
      name="stressCollection_cement"
      objectPath="ElementRegions/cement/cement"
      fieldName="cement_stress"/>
    <PackCollection
      name="stressCollection_rock"
      objectPath="ElementRegions/rock/rock"
      fieldName="rock_stress"/>

    <PackCollection
      name="displacementCollection"
      objectPath="nodeManager"
      fieldName="totalDisplacement"/>
    
  </Tasks>

  <Outputs>
    <TimeHistory
      name="stressHistoryOutput_casing"
      sources="{ /Tasks/stressCollection_casing }"
      filename="stressHistory_casing"/>
    <TimeHistory
      name="stressHistoryOutput_cement"
      sources="{ /Tasks/stressCollection_cement }"
      filename="stressHistory_cement"/>
    <TimeHistory
      name="stressHistoryOutput_rock"
      sources="{ /Tasks/stressCollection_rock }"
      filename="stressHistory_rock"/>

    <TimeHistory
      name="displacementHistoryOutput"
      sources="{ /Tasks/displacementCollection }"
      filename="displacementHistory"/>

    <VTK name="vtkOutput"/>
    <Restart
      name="restartOutput"/>
  </Outputs>
</Problem>
