<?xml version="1.0" ?>

<Problem>
  <Solvers gravityVector="{-1, 0, 0}">
    <CompositionalMultiphaseFVM
        name="compflow"
        logLevel="1"
        discretization="fluidTPFA"
        targetRegions="{ Region1 }"
        temperature="297.15">
      <NonlinearSolverParameters
          newtonTol="5e-4"
          lineSearchAction="None"
          newtonMaxIter="100"/>
      <LinearSolverParameters
          directParallel="0"/>
    </CompositionalMultiphaseFVM>
  </Solvers>

  <Geometry>
    <Box
        name="source"
        xMin="{ -0.01, -0.01, -0.01 }"
        xMax="{ 1.01, 1.01, 1.01 }"/>
  </Geometry>

  <Events
      maxTime="1.0368e8">
    <PeriodicEvent
        name="outputs"
        cycleFrequency="1"
        target="/Outputs/vtkOutput"/>

    <PeriodicEvent
        name="solverApplications1"
        forceDt="1.728e6"
        target="/Solvers/compflow"/>

    <PeriodicEvent
        name="restarts"
        timeFrequency="3e7"
        targetExactTimestep="0"
        target="/Outputs/restartOutput"/>
  </Events>

  <ElementRegions>
    <CellElementRegion
        name="Region1"
        cellBlocks="{ block1 }"
        materialList="{ fluid, rock, relperm }"/>
  </ElementRegions>

  <Constitutive>
    <CO2BrinePhillipsFluid
      name="fluid"
      logLevel="1"
      phaseNames="{ gas, water }"
      componentNames="{ co2, water }"
      componentMolarWeight="{ 44e-3, 18e-3 }"
      phasePVTParaFiles="{ pvtgas.txt, pvtliquid.txt }"
      flashModelParaFile="co2flash.txt"/>

    <CompressibleSolidConstantPermeability
        name="rock"
        solidModelName="nullSolid"
        porosityModelName="rockPorosity"
        permeabilityModelName="rockPerm"/>

    <NullModel
        name="nullSolid"/>

    <PressurePorosity
        name="rockPorosity"
        defaultReferencePorosity="0.2"
        referencePressure="0.0"
        compressibility="1.0e-9"/>

    <BrooksCoreyRelativePermeability
        name="relperm"
        phaseNames="{ gas, water }"
        phaseMinVolumeFraction="{ 0.0, 0.0 }"
        phaseRelPermExponent="{ 2.0, 2.5 }"
        phaseRelPermMaxValue="{ 0.9, 0.9 }"/>

    <ConstantPermeability
        name="rockPerm"
        permeabilityComponents="{ 5.0e-15, 5.0e-15, 5.0e-15 }"/>
  </Constitutive>

  <FieldSpecifications>
    <!-- Initial pressure: ~5 bar -->
    <FieldSpecification
        name="initialPressure"
        initialCondition="1"
        setNames="{ all }"
        objectPath="ElementRegions/Region1/block1"
        fieldName="pressure"
        scale="7.5e6"/>

    <FieldSpecification
        name="initialComposition_co2"
        initialCondition="1"
        setNames="{ all }"
        objectPath="ElementRegions/Region1/block1"
        fieldName="globalCompFraction"
        component="0"
        functionName="initial_co2"
        scale="1"/>

    <FieldSpecification
        name="initialComposition_water"
        initialCondition="1"
        setNames="{ all }"
        objectPath="ElementRegions/Region1/block1"
        fieldName="globalCompFraction"
        component="1"
        functionName="initial_water"
        scale="1"/>

<!--
    <SourceFlux
        name="sourceTerm"
        logLevel="10"
        objectPath="ElementRegions/Region1/block1"
        component="0"
        scale="-1e-3"
        setNames="{ source }"/>
-->

  </FieldSpecifications>

  <Functions>
    <TableFunction name="initial_co2"
                   inputVarNames="{elementCenter}"
                   coordinates="{0.0, 4., 5., 10.}"
                   values="{1.0, 1.0, 0.0, 0.0}"
    />
    <TableFunction name="initial_water"
                   inputVarNames="{elementCenter}"
                   coordinates="{0.0, 4., 5., 10.}"
                   values="{0.0, 0.0, 1.0, 1.0}"
    />
  </Functions>

  <Outputs>
    <Restart
        name="restartOutput"/>
  </Outputs>
</Problem>
