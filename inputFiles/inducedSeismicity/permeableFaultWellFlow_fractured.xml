<?xml version="1.0" ?>

<Problem>
  <!-- SPHINX_ELEMENTREGIONS -->
  <ElementRegions>
    <CellElementRegion
      name="burden"
      cellBlocks="{ 94_hexahedra, 95_hexahedra, 96_hexahedra, 97_hexahedra, 94_wedges, 95_wedges, 96_wedges, 97_wedges}"
      materialList="{ water, rock_burden }"/>  
    <CellElementRegion
      name="reservoir"
      cellBlocks="{ 98_hexahedra, 99_hexahedra, 98_wedges, 99_wedges }"
      materialList="{ water, rock_reservoir }"/>  
    <WellElementRegion
      name="wellRegion"
      materialList="{ water }"/>
    <SurfaceElementRegion
      name="Fracture"
      faceBlock="fracture"
      defaultAperture="1.0e-3"
      materialList="{ water, fractureFilling }"/>
  </ElementRegions> 
  <!-- SPHINX_ELEMENTREGIONS_END -->

  <!-- SPHINX_MESH -->
  <Mesh>
     <VTKMesh
      name="FaultModel"
      file="fracturedMesh_2D_irreg.vtm"
      regionAttribute="CellEntityIds"
      useGlobalIds="1"
      faceBlocks="{fracture}">
      <InternalWell
        name="well_injector"
        logLevel="1"
        wellRegionName="wellRegion"
        wellControlsName="wellControls"
        polylineNodeCoords="{ { 500.0, 500.0, 600.0 },
                              { 500.0, 500.0, 500.0 },
                              { 500.0, -500.0, 500.0 } }"
        polylineSegmentConn="{ { 0, 1 },
                               { 1, 2 } }"
        radius="0.01"
        numElementsPerSegment="1">
        <Perforation
          name="injector_perf"
          distanceFromHead="650."/>
        </InternalWell>
    </VTKMesh>
  </Mesh>
  <!-- SPHINX_MESH_END -->

  <!-- SPHINX_NUMERICAL -->
  <NumericalMethods>
    <FiniteElements>
      <FiniteElementSpace
        name="FE1"
        order="1"/>
    </FiniteElements>

    <FiniteVolume>
      <TwoPointFluxApproximation
        name="singlePhaseTPFA"/>
    </FiniteVolume>
  </NumericalMethods>
  <!-- SPHINX_NUMERICAL_END -->

  <!-- SPHINX_MATERIAL -->
  <Constitutive>
    <CompressibleSinglePhaseFluid 
      name="water"
      defaultDensity="1000"
      defaultViscosity="0.001"
      referencePressure="0e6"
      referenceDensity="1000"
      compressibility="2.09028227021e-10"
      referenceViscosity="0.001"
      viscosibility="0.0"
    />

    <CompressibleSolidConstantPermeability
      name="rock_burden"
      solidModelName="nullSolid"
      porosityModelName="rockPorosity"
      permeabilityModelName="rockPerm_burden"/>

    <CompressibleSolidConstantPermeability
      name="rock_reservoir"
      solidModelName="nullSolid"
      porosityModelName="rockPorosity"
      permeabilityModelName="rockPerm_reservoir"/>

    <ConstantPermeability
      name="rockPerm_burden"
      permeabilityComponents="{1.0e-20, 1.0e-20, 1.0e-20}"
    /> 

    <ConstantPermeability
      name="rockPerm_reservoir"
      permeabilityComponents="{1.0e-14, 1.0e-14, 1.0e-14}"
    /> 

    <CompressibleSolidParallelPlatesPermeability
      name="fractureFilling"
      solidModelName="nullSolid"
      porosityModelName="fracturePorosity"
      permeabilityModelName="fracturePerm"/>

    <PressurePorosity
      name="rockPorosity"
      defaultReferencePorosity="0.01"
      referencePressure="0.0"
      compressibility="1e-9"/>

    <PressurePorosity
      name="fracturePorosity"
      defaultReferencePorosity="1.00"
      referencePressure="0.0"
      compressibility="0.0"/>

    <ParallelPlatesPermeability
      name="fracturePerm"/>

    <NullModel
      name="nullSolid"/>
  </Constitutive>
  <!-- SPHINX_MATERIAL_END -->

  <Solvers gravityVector="{0.0, 0.0, 0.0}">
    <SinglePhaseReservoir
      name="reservoirSystem"
      flowSolverName="singlePhaseFlowSolver"
      wellSolverName="singlePhaseWell"
      targetRegions="{ burden, reservoir, wellRegion }">
      <NonlinearSolverParameters
        newtonTol="1.0e-6"
        newtonMaxIter="8"/>
      <LinearSolverParameters
        solverType="gmres"
        krylovTol="1.0e-10"/>
    </SinglePhaseReservoir>

    <!-- SPHINX_SINGLEPHASEFVM -->
    <SinglePhaseFVM
      name="singlePhaseFlowSolver"
      logLevel="1"
      discretization="singlePhaseTPFA"
      targetRegions="{ burden, reservoir, Fracture }">
      <NonlinearSolverParameters
        newtonTol = "1.0e-6"
        newtonMaxIter = "8"/>
      <LinearSolverParameters
        solverType="gmres"
        krylovTol="1.0e-12"/>
    </SinglePhaseFVM>

    <SinglePhaseWell
      name="singlePhaseWell"
      logLevel="1"
      targetRegions="{ wellRegion }">
      <WellControls
        name="wellControls"
        type="injector"
        control="totalVolRate"
        initialPressureCoefficient="0.0"
        referenceElevation="550"
        targetBHP="1e9"
        targetTotalRate="1e-3"/>
    </SinglePhaseWell>
  </Solvers>
  <!-- SPHINX_SINGLEPHASEFVM_END -->

  <Geometry>
    <Box
      name="left"
      xMin="{ -2000.1, -1000.1, -0.1 }"
      xMax="{ -1999.9,  1000.1, 1000.1 }"/>
    <Box
      name="right"
      xMin="{ 1999.9, -1000.1, -0.1 }"
      xMax="{ 2000.1,  1000.1, 1000.1 }"/>
    <Box
      name="top"
      xMin="{ -2000.1,  999.9, -0.1 }"
      xMax="{  2000.1, 1000.1, 1000.1 }"/>
    <Box
      name="bottom"
      xMin="{ -2000.1, -1000.1, -0.1 }"
      xMax="{  2000.1,  -999.9, 1000.1 }"/>
    <Box
      name="back"
      xMin="{ -2000.1, -1000.1, -0.1 }"
      xMax="{  2000.1,  1000.1, 0.1 }"/>
    <Box
      name="front"
      xMin="{ -2000.1, -1000.1, 999.9 }"
      xMax="{  2000.1,  1000.1, 1000.1 }"/>
  </Geometry>

  <!-- SPHINX_BC --> 
  <FieldSpecifications>
    <FieldSpecification 
      name="initialPressure_burden"
      initialCondition="1"
      setNames="{all}"
      objectPath="ElementRegions/burden"
      fieldName="pressure"
      scale="0.1e6"
    />

    <FieldSpecification 
      name="initialPressure_reservoir"
      initialCondition="1"
      setNames="{all}"
      objectPath="ElementRegions/reservoir"
      fieldName="pressure"
      scale="0.1e6"
    />

    <FieldSpecification
      name="initialPressure"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/Fracture"
      fieldName="pressure"
      scale="0.1e6"/>
    	     
    <FieldSpecification
      name="fracPorosity"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/Fracture"
      fieldName="fracturePorosity_porosity"
      scale="1.00"/>
  </FieldSpecifications>
  <!-- SPHINX_BC_END -->

  <Functions>
    <TableFunction
      name="apertureTable"
      coordinates="{ -1.0e-3, 0.0 }"
      values="{ 0.002e-3, 0.02e-3 }"/>
  </Functions>

  <Events maxTime="1e7">
    <PeriodicEvent
      name="outputs"
      timeFrequency="1e4"
      target="/Outputs/vtkOutput"/>

    <PeriodicEvent
      name="solverApplications"
      forceDt="1e4"
      target="/Solvers/reservoirSystem"/>
  </Events>

  <!-- SPHINX_OUTPUT -->  
  <Outputs>
    <VTK 
      name="vtkOutput"
      parallelThreads="1"
      plotFileRoot="permeableWellFlowFractured"/>

    <Restart
      name="restartOutput"
    />  
  </Outputs>
  <!-- SPHINX_OUTPUT_END -->
</Problem>
