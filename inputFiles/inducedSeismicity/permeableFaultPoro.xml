<?xml version="1.0" ?>

<Problem>
  <!-- SPHINX_ELEMENTREGIONS -->
  <ElementRegions>
    <CellElementRegion
      name="burden"
      cellBlocks="{ 94_hexahedra, 95_hexahedra, 96_hexahedra, 97_hexahedra, 94_wedges, 95_wedges, 96_wedges, 97_wedges}"
      materialList="{ water, porousRock_burden }"/>
    <CellElementRegion
      name="reservoir"
      cellBlocks="{ 98_hexahedra, 99_hexahedra, 98_wedges, 99_wedges }"
      materialList="{ water, porousRock_reservoir }"/>
    <!--SurfaceElementRegion
      name="Fracture"
      faceBlock="fracture"
      defaultAperture="1.0e-3"
      materialList="{ water, fractureFilling, fractureContact }"/-->
  </ElementRegions> 
  <!-- SPHINX_ELEMENTREGIONS_END -->

  <!-- SPHINX_NUMERICAL -->
  <NumericalMethods>
    <FiniteElements>
      <FiniteElementSpace
        name="FE1"
        order="1"/>
    </FiniteElements>

    <FiniteVolume>
      <TwoPointFluxApproximation
        name="singlePhaseTPFA"/>
      <!--TwoPointFluxApproximation
        name="singlePhaseTPFA_stab"/-->
    </FiniteVolume>
  </NumericalMethods>
  <!-- SPHINX_NUMERICAL_END -->

  <!-- SPHINX_MESH -->
  <Mesh>
     <VTKMesh
      name="FaultModel"
      file="faultMesh_2D_irreg.vtk"
      regionAttribute="CellEntityIds">
     </VTKMesh>
  </Mesh>
  <!-- SPHINX_MESH_END -->

  <!-- SPHINX_POROMECHANICSSOLVER -->
  <Solvers gravityVector="{0.0, 0.0, 0.0}">
    <SinglePhasePoromechanics
      name="poromechanicsSolver"
      solidSolverName="mechanicsSolver"
      flowSolverName="singlePhaseFlowSolver"
      logLevel="1"
      targetRegions="{ burden, reservoir }">
      <LinearSolverParameters
        solverType="gmres"
        preconditionerType="mgr"
        logLevel="1"
        krylovAdaptiveTol="1"
      />
      <NonlinearSolverParameters
        newtonMaxIter = "40"
      />
    </SinglePhasePoromechanics>
    <!-- SPHINX_POROMECHANICSSOLVER_END -->

    <!-- SPHINX_MECHANICALSOLVER -->
    <SolidMechanics_LagrangianFEM
      name="mechanicsSolver"
      timeIntegrationOption="QuasiStatic"
      logLevel="1"
      discretization="FE1"
      targetRegions="{ burden, reservoir }">
      <NonlinearSolverParameters
        newtonTol = "1.0e-5"
        newtonMaxIter = "15"/>
      <LinearSolverParameters
        solverType="gmres"
        krylovTol="1.0e-10"/>
    </SolidMechanics_LagrangianFEM>
    <!-- SPHINX_MECHANICALSOLVER_END -->

    <!-- SPHINX_SINGLEPHASEFVM -->
    <SinglePhaseFVM
      name="singlePhaseFlowSolver"
      logLevel="1"
      discretization="singlePhaseTPFA"
      targetRegions="{ burden, reservoir }">
      <NonlinearSolverParameters
        newtonTol = "1.0e-6"
        newtonMaxIter = "8"
      />
      <LinearSolverParameters
        solverType="gmres"
        krylovTol="1.0e-12"/>
    </SinglePhaseFVM>
   </Solvers>
   <!-- SPHINX_SINGLEPHASEFVM_END -->

  <!-- SPHINX_MATERIAL -->
  <Constitutive>
    <PorousElasticIsotropic
      name="porousRock_burden"
      solidModelName="rock"
      porosityModelName="rockPorosity"
      permeabilityModelName="rockPerm_burden"
    />

    <PorousElasticIsotropic
      name="porousRock_reservoir"
      solidModelName="rock"
      porosityModelName="rockPorosity"
      permeabilityModelName="rockPerm_reservoir"
    />

    <ElasticIsotropic
      name="rock"
      defaultDensity="2700"
      defaultYoungModulus="14.95e9"
      defaultPoissonRatio="0.15"
    />

    <CompressibleSinglePhaseFluid 
      name="water"
      defaultDensity="1000"
      defaultViscosity="0.001"
      referencePressure="0e6"
      referenceDensity="1000"
      compressibility="2.09028227021e-10"
      referenceViscosity="0.001"
      viscosibility="0.0"
    />

    <BiotPorosity
      name="rockPorosity"
      grainBulkModulus="7.12e10"
      defaultReferencePorosity="0.3"
    />  

    <ConstantPermeability
      name="rockPerm_burden"
      permeabilityComponents="{1.0e-12, 1.0e-12, 1.0e-12}"
    /> 

    <ConstantPermeability
      name="rockPerm_reservoir"
      permeabilityComponents="{1.0e-12, 1.0e-12, 1.0e-12}"
    /> 

    <CompressibleSolidParallelPlatesPermeability
      name="fractureFilling"
      solidModelName="nullSolid"
      porosityModelName="fracturePorosity"
      permeabilityModelName="fracturePerm"/>

    <PressurePorosity
      name="fracturePorosity"
      defaultReferencePorosity="1.00"
      referencePressure="0.0"
      compressibility="0.0"/>

    <ParallelPlatesPermeability
      name="fracturePerm"/>

    <NullModel
      name="nullSolid"/>

    <Coulomb
      name="fractureContact"
      cohesion="0.0"
      frictionCoefficient="0.1"
      apertureTableName="apertureTable"/>

    <!--FrictionlessContact
      name="fractureContact"
      penaltyStiffness="1.0e8"
      apertureTableName="apertureTable"/-->
  </Constitutive>
  <!-- SPHINX_MATERIAL_END -->

  <Geometry>
    <Box
      name="left"
      xMin="{ -2000.1, -1000.1, -0.1 }"
      xMax="{ -1999.9,  1000.1, 1000.1 }"/>
    <Box
      name="right"
      xMin="{ 1999.9, -1000.1, -0.1 }"
      xMax="{ 2000.1,  1000.1, 1000.1 }"/>
    <Box
      name="top"
      xMin="{ -2000.1,  999.9, -0.1 }"
      xMax="{  2000.1, 1000.1, 1000.1 }"/>
    <!--Box
      name="top_left"
      xMin="{ -2000.1,  999.9, -0.1 }"
      xMax="{   577.3, 1000.1, 1000.1 }"/-->
    <!--Box
      name="top_right"
      xMin="{   577.3,  999.9, -0.1 }"
      xMax="{  2000.1, 1000.1, 1000.1 }"/-->
    <Box
      name="bottom"
      xMin="{ -2000.1, -1000.1, -0.1 }"
      xMax="{  2000.1,  -999.9, 1000.1 }"/>
    <!--Box
      name="bottom_left"
      xMin="{ -2000.1, -1000.1, -0.1 }"
      xMax="{  -577.3,  -999.9, 1000.1 }"/-->
    <!--Box
      name="bottom_right"
      xMin="{  -577.3, -1000.1, -0.1 }"
      xMax="{  2000.1,  -999.9, 1000.1 }"/-->
    <Box
      name="back"
      xMin="{ -2000.1, -1000.1, -0.1 }"
      xMax="{  2000.1,  1000.1, 0.1 }"/>
    <Box
      name="front"
      xMin="{ -2000.1, -1000.1, 999.9 }"
      xMax="{  2000.1,  1000.1, 1000.1 }"/>
  </Geometry>

  <!-- SPHINX_BC --> 
  <FieldSpecifications>
    <FieldSpecification 
      name="initialPressure_burden"
      initialCondition="1"
      setNames="{all}"
      objectPath="ElementRegions/burden"
      fieldName="pressure"
      scale="0.0e6"
    />

    <FieldSpecification 
      name="initialPressure_reservoir"
      initialCondition="1"
      setNames="{all}"
      objectPath="ElementRegions/reservoir"
      fieldName="pressure"
      scale="0.0e6"
    />

    <FieldSpecification 
      name="stressXX_burden"
      initialCondition="1"
      setNames="{all}"
      objectPath="ElementRegions/burden"
      fieldName="rock_stress"
      component="0"
      scale="-28.5e6"
    />

    <FieldSpecification 
      name="stressXX_reservoir"
      initialCondition="1"
      setNames="{all}"
      objectPath="ElementRegions/reservoir"
      fieldName="rock_stress"
      component="0"
      scale="-28.5e6"
    />

    <FieldSpecification 
      name="stressYY_burden"
      initialCondition="1"
      setNames="{all}"
      objectPath="ElementRegions/burden"
      fieldName="rock_stress"
      component="1"
      scale="-70.0e6"
    />

    <FieldSpecification 
      name="stressYY_reservoir"
      initialCondition="1"
      setNames="{all}"
      objectPath="ElementRegions/reservoir"
      fieldName="rock_stress"
      component="1"
      scale="-70.0e6"
    />

    <FieldSpecification 
      name="stressZZ_burden"
      initialCondition="1"
      setNames="{all}"
      objectPath="ElementRegions/burden"
      fieldName="rock_stress"
      component="2"
      scale="0e6"
    />

    <FieldSpecification 
      name="stressZZ_reservoir"
      initialCondition="1"
      setNames="{all}"
      objectPath="ElementRegions/reservoir"
      fieldName="rock_stress"
      component="2"
      scale="0e6"
    />

    <FieldSpecification
      name="xconstraint"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="0"
      scale="0.0"
      setNames="{ left, right }"/>

    <!--FieldSpecification
      name="xconstraint_lhs"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="0"
      scale="0.0"
      setNames="{ left }"/-->

    <!--FieldSpecification
      name="xconstraint_rhs"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="0"
      scale="1e1"
      functionName="xrhsDisplacementLoadingFunction"
      setNames="{ right }"/-->

    <FieldSpecification
      name="yconstraint"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="1"
      scale="0.0"
      setNames="{ bottom }"/>

    <!--FieldSpecification
      name="yconstraint_lhs"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="1"
      scale="0.0"
      setNames="{ bottom_left }"/-->

    <!--FieldSpecification
      name="yconstraint_rhs"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="1"
      scale="1e1"
      functionName="yrhsDisplacementLoadingFunction"
      setNames="{ bottom_right }"/-->

    <FieldSpecification
      name="zconstraintFront"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="2"
      scale="0.0"
      setNames="{ front, back }"/>

    <Traction
      name="NormalTraction"
      objectPath="faceManager"
      tractionType="normal"
      scale="-70e6"
      setNames="{ top }"/>
    <!--Traction
      name="NormalTractionLhs"
      objectPath="faceManager"
      tractionType="normal"
      scale="-0e4"
      setNames="{ left }"/>
    <Traction
      name="NormalTractionRhs"
      objectPath="faceManager"
      tractionType="normal"
      scale="-0e4"
      setNames="{ right }"/-->

  </FieldSpecifications>
  <!-- SPHINX_BC_END -->

  <Functions>
    <TableFunction
      name="apertureTable"
      coordinates="{ -1.0e-3, 0.0 }"
      values="{ 0.002e-3, 0.02e-3 }"/>
    <TableFunction
      name="xrhsDisplacementLoadingFunction"
      inputVarNames="{ time }"
      coordinates="{ 0.0, 1000000.0 }"
      values="{ 0.0, 0.0 }"/>
    <TableFunction
      name="yrhsDisplacementLoadingFunction"
      inputVarNames="{ time }"
      coordinates="{ 0.0, 1000000.0 }"
      values="{ 0.0, 0.0 }"/>

    <TableFunction
      name="compressiveLoadingFunction"
      inputVarNames="{ time }"
      coordinates="{ 0.0, 10000000.0, 20000000.0}"
      values="{ 0.0, 0.0, -1.0 }"/>
    <TableFunction
      name="compressiveLoadingFunctionLhs"
      inputVarNames="{ time }"
      coordinates="{ 0.0, 10000000.0, 20000000.0}"
      values="{ 0.0, 0.0, -0.4 }"/>
    <TableFunction
      name="compressiveLoadingFunctionRhs"
      inputVarNames="{ time }"
      coordinates="{ 0.0, 10000000.0, 20000000.0}"
      values="{ 0.0, 0.0, -0.4 }"/>
  </Functions>

  <Events maxTime="1e7">
    <PeriodicEvent
      name="outputs"
      timeFrequency="1e7"
      target="/Outputs/vtkOutput"/>

    <PeriodicEvent
      name="solverApplicationsInit"
      endTime="1e7"
      forceDt="1e7"
      target="/Solvers/poromechanicsSolver"/>
  </Events>

  <!-- SPHINX_OUTPUT -->  
  <Outputs>
    <VTK 
      name="vtkOutput"
      parallelThreads="1"
      plotFileRoot="permeableFaultPoro"/>

    <Restart
      name="restartOutput"
    />  
  </Outputs>
  <!-- SPHINX_OUTPUT_END -->
</Problem>
