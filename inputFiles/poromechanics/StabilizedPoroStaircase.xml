<?xml version="1.0" ?>

<Problem>
  <Solvers
   gravityVector="{ 0, 0, 0 }">
    <MultiphasePoromechanics
      name="MultiphasePoroelasticitySolver"
      solidSolverName="LinearElasticitySolver"
      flowSolverName="TwoPhaseFlowSolver"
      logLevel="1"
      discretization="FE1"
      targetRegions="{ Channel, Barrier }"
      initialDt="8.64"
      stabilizationType="None"
      stabilizationRegionNames="{ Channel, Barrier }">
      <NonlinearSolverParameters
        newtonTol="1.0e-6"
        newtonMaxIter="15"
        lineSearchAction="None"
        lineSearchMaxCuts="2"/>
      <LinearSolverParameters
        solverType="direct"/>
    </MultiphasePoromechanics>

    <SolidMechanicsLagrangianSSLE
      name="LinearElasticitySolver"
      timeIntegrationOption="QuasiStatic"
      logLevel="1"
      discretization="FE1"
      targetRegions="{ Channel, Barrier  }"/>

    <CompositionalMultiphaseFVM
      name="TwoPhaseFlowSolver"
      logLevel="1"
      discretization="fluidTPFA"
      targetRegions="{ Channel, Barrier  }"
      temperature="300"
      computeCFLNumbers="1"
      useMass="1"/>
  </Solvers>

  <Mesh>
    <InternalMesh
      name="mesh"
      elementTypes="{ C3D8 }"
      xCoords="{ 0, 250, 500 }"
      yCoords="{ 0, 250, 500 }"
      zCoords="{ 0, 62.5, 125, 187.5, 250 }"
      nx="{ 4, 4 }"
      ny="{ 4, 4 }"
      nz="{ 2, 2, 2, 2 }"
      cellBlockNames="{ b00, b01, b02, b03, b04, b05, b06, b07, b08, b09, b10, b11, b12, b13, b14, b15 }"/>
  </Mesh>

  <!-- END_SPHINX_INCLUDE_MESH_BLOCK -->
  <!-- START_SPHINX_INCLUDE_GEOM_BLOCK -->
  <Geometry>
    <Box
      name="source"
      xMin="{ 437.4, -0.01, 187.49 }"
      xMax="{ 500.01, 62.6, 250.01 }"/>

    <Box
      name="sink"
      xMin="{ 437.4, -0.01, -0.01 }"
      xMax="{ 500.01, 62.6, 62.51 }"/>
  </Geometry>

  <Events
    maxTime="17.28">

    <PeriodicEvent
      name="outputs"
      timeFrequency="8.64"
      target="/Outputs/vtkOutput"/>

    <PeriodicEvent
      name="solverApplications1"
      maxEventDt="8.64"
      target="/Solvers/MultiphasePoroelasticitySolver"/>

    <PeriodicEvent
      name="restarts"
      timeFrequency="8.64"
      target="/Outputs/restartOutput"/>
  </Events>

  <NumericalMethods>
    <FiniteElements>
      <FiniteElementSpace
        name="FE1"
        order="1"/>
    </FiniteElements>

    <FiniteVolume>
      <TwoPointFluxApproximation
        name="fluidTPFA"/>
    </FiniteVolume>
  </NumericalMethods>

  <ElementRegions>
    <CellElementRegion
      name="Channel"
      cellBlocks="{ b08, b00, b01, b05, b06, b14, b15, b11 }"
      materialList="{ fluid, porousRockChannel, relperm }"/>

    <CellElementRegion
      name="Barrier"
      cellBlocks="{ b04, b12, b13, b09, b10, b02, b03, b07 }"
      materialList="{ fluid, porousRockBarrier, relperm }"/>
  </ElementRegions>

  <Constitutive>
    <DeadOilFluid
      name="fluid"
      phaseNames="{ oil, water }"
      surfaceDensities="{ 863.0, 1035.0 }"
      componentMolarWeight="{ 114e-3, 18e-3 }"
      tableFiles="{ pvt_tables/StabilizedPoroStaircase_pvdo.txt, pvt_tables/StabilizedPoroStaircase_pvtw.txt }"/>

      <BrooksCoreyRelativePermeability
      name="relperm"
      phaseNames="{ oil, water }"
      phaseMinVolumeFraction="{ 0.2, 0.2 }"
      phaseRelPermExponent="{ 2, 2 }"
      phaseRelPermMaxValue="{ 1.0, 1.0 }"/>

    <PorousElasticIsotropic
      name="porousRockChannel"
      solidModelName="skeletonChannel"
      porosityModelName="rockPorosityChannel"
      permeabilityModelName="rockPermChannel"/>
    <ElasticIsotropic
      name="skeletonChannel"
      defaultDensity="2650"
      defaultBulkModulus="5.e9"
      defaultPoissonRatio="0.25"/>
    <ConstantPermeability
      name="rockPermChannel"
      permeabilityComponents="{ 9.8e-13, 9.8e-13, 9.8e-13 }"/>
    <BiotPorosity
      name="rockPorosityChannel"
      grainBulkModulus="1.0e27"
      defaultReferencePorosity="0.2"/>

    <PorousElasticIsotropic
      name="porousRockBarrier"
      solidModelName="skeletonBarrier"
      porosityModelName="rockPorosityBarrier"
      permeabilityModelName="rockPermBarrier"/>
    <ElasticIsotropic
      name="skeletonBarrier"
      defaultDensity="2650"
      defaultBulkModulus="5.e9"
      defaultPoissonRatio="0.25"/>
    <ConstantPermeability
      name="rockPermBarrier"
      permeabilityComponents="{ 9.8e-16, 9.8e-16, 9.8e-16 }"/>
    <BiotPorosity
      name="rockPorosityBarrier"
      grainBulkModulus="1.0e27"
      defaultReferencePorosity="0.05"/>
  </Constitutive>

  <FieldSpecifications>

    <HydrostaticEquilibrium
      name="equil"
      objectPath="ElementRegions"      
      datumElevation="125"
      datumPressure="0.0"
      initialPhaseName="oil"
      componentNames="{ oil, water }"
      componentFractionVsElevationTableNames="{ initOilCompFracTable,
                                                initWaterCompFracTable }"
      temperatureVsElevationTableName="initTempTable"/>

    <FieldSpecification
      name="sourceTerm"
      objectPath="ElementRegions"
      fieldName="pressure"
      scale="5e6"
      functionName="sourceSinkTable"
      setNames="{ source }"/>
    <FieldSpecification
      name="sourceTermComposition_oil"
      setNames="{ source }"
      objectPath="ElementRegions"
      fieldName="globalCompFraction"
      component="0"
      scale="1.0"
      functionName="sourceCompOilTable"/>
    <FieldSpecification
      name="sourceTermComposition_water"
      setNames="{ source }"
      objectPath="ElementRegions"
      fieldName="globalCompFraction"
      component="1"
      scale="1.0"
      functionName="sourceCompWaterTable"/>


    <FieldSpecification
      name="sinkTerm"
      objectPath="ElementRegions"
      fieldName="pressure"
      scale="-5e6"
      functionName="sourceSinkTable"
      setNames="{ sink }"/>
    <FieldSpecification
      name="sinkTermComposition_oil"
      setNames="{ sink }"
      objectPath="ElementRegions"
      fieldName="globalCompFraction"
      component="0"
      scale="0.79"/>
    <FieldSpecification
      name="sinkTermComposition_water"
      setNames="{ sink }"
      objectPath="ElementRegions"
      fieldName="globalCompFraction"
      component="1"
      scale="0.21"/>


    <FieldSpecification
      name="xconstraint"
      objectPath="nodeManager"
      fieldName="TotalDisplacement"
      component="0"
      scale="0.0"
      setNames="{ xneg, xpos }"/>
    <FieldSpecification
      name="yconstraint"
      objectPath="nodeManager"
      fieldName="TotalDisplacement"
      component="1"
      scale="0.0"
      setNames="{ yneg, ypos }"/>
    <FieldSpecification
      name="zconstraint"
      objectPath="nodeManager"
      fieldName="TotalDisplacement"
      component="2"
      scale="0.0"
      setNames="{ zneg }"/>
  </FieldSpecifications>

  <Functions>
    <TableFunction
      name="sourceSinkTable"
      inputVarNames="{ time }"
      interpolation="linear"
      coordinates="{ 0, 86400, 1e9 }"
      values="{ 0, 1, 1 }"/> 

    <TableFunction
      name="sourceCompOilTable"
      inputVarNames="{ time }"
      interpolation="linear"
      coordinates="{ 0, 86400, 1e9 }"
      values="{ 0.79, 0.21, 0.21 }"/>
    <TableFunction
      name="sourceCompWaterTable"
      inputVarNames="{ time }"
      interpolation="linear"
      coordinates="{ 0, 86400, 1e9 }"
      values="{ 0.21, 0.79, 0.79 }"/>

   <TableFunction
      name="initOilCompFracTable"
      coordinateFiles="{ StabilizedPoroStaircase_elevation.txt }"
      voxelFile="StabilizedPoroStaircase_initOilCompFrac.txt"/>
    <TableFunction
      name="initWaterCompFracTable"
      coordinateFiles="{ StabilizedPoroStaircase_elevation.txt }"
      voxelFile="StabilizedPoroStaircase_initWaterCompFrac.txt"/>       
    <TableFunction
      name="initTempTable"
      coordinateFiles="{ StabilizedPoroStaircase_elevation.txt }"
      voxelFile="StabilizedPoroStaircase_initTemp.txt"/> 
  </Functions>

  <Outputs>

    <VTK
      name="vtkOutput"/>

    <Restart
      name="restartOutput"/>
  </Outputs>
</Problem>








