<?xml version="1.0" ?>

<Problem>
  <Solvers gravityVector="{0.0, -9.81, 0.0}">
    <LagrangianContact
      name="poroFractureSolver"
      solidSolverName="mechanicsSolver"
      stabilizationName="singlePhaseTPFA_stab"
      logLevel="1"
      targetRegions="{ Reservoir, Overburden, Underburden, Fault}" 
      fractureRegionName="Fault"
      discretization="FE1"
      contactRelationName="fractureContact">
      <NonlinearSolverParameters
        maxTimeStepCuts="1"
        newtonTol="1e-8"
        newtonMaxIter="10"
        maxAllowedResidualNorm="1e+15"/>
      <LinearSolverParameters
        directParallel="0"/>   
    </LagrangianContact>

    <SolidMechanicsLagrangianSSLE 
      name="mechanicsSolver" 
      timeIntegrationOption="QuasiStatic"
      logLevel="1"
      discretization="FE1"
      targetRegions="{ Reservoir, Overburden, Underburden }" >
    </SolidMechanicsLagrangianSSLE>

    <SurfaceGenerator
      logLevel="0"
      name="SurfaceGen"
      targetRegions="{ Reservoir, Overburden, Underburden }" 
      fractureRegion="Fault"
      rockToughness="1e6"
      mpiCommOrder="1"/>
  </Solvers>

  <Mesh>
     <VTKMesh         
      name="mesh1"      
      file="./meshes/new_setup_vertical_middle.vtu"
      regionAttribute="CellEntityIds"/>
  </Mesh>  

  <ElementRegions>
    <CellElementRegion
      name="Reservoir"
      cellBlocks="{ 99991_wedges }"
      materialList="{ rock }"/>
    <CellElementRegion
      name="Overburden"
      cellBlocks="{  99992_wedges }"
      materialList="{ rock }"/> 
    <CellElementRegion
      name="Underburden"
      cellBlocks="{ 99993_wedges }"
      materialList="{ rock }"/>       

  <SurfaceElementRegion
      name="Fault"
      faceBlock="faceElementSubRegion"
      materialList="{ fractureContact }"
      defaultAperture="1e-3"/>
  </ElementRegions> 

  <Geometry>
    <BoundedPlane
      name="fault"
      normal="{-1.0, 0.0, 0.0}"
      origin="{0.0, 0.0, 250.0}"
      lengthVector="{0.0, 1.0, 0.0}"
      widthVector="{0.0, 0.0, 1.0}"
      dimensions="{ 650.0, 500.0 }"/>
  </Geometry>

  <NumericalMethods>
    <FiniteVolume>
      <TwoPointFluxApproximation
        name="singlePhaseTPFA_stab"/>  
    </FiniteVolume>
    <FiniteElements>
      <FiniteElementSpace
        name="FE1"
        order="1"/>
    </FiniteElements>
  </NumericalMethods>

  <Constitutive>
    <!--rock-->
    <ElasticIsotropic
      name="rock"
      defaultDensity="2650.0"
      defaultYoungModulus="14.95e9"
      defaultPoissonRatio="0.15"/>
      
    <!-- Material inside the fault -->
    <Coulomb
      name="fractureContact"
      cohesion="0.0e6"
      frictionCoefficient="0.001"
      apertureTableName="apertureTable"/>

    <NullModel
      name="nullSolid"/>

  </Constitutive>

  <FieldSpecifications>
    <FieldSpecification
      name="frac"
      initialCondition="1"
      setNames="{ fault }"
      objectPath="faceManager"
      fieldName="ruptureState"
      scale="1"/>

    <FieldSpecification
      name="separableFace"
      initialCondition="1"
      setNames="{ fault }"
      objectPath="faceManager"
      fieldName="isFaceSeparable"
      scale="1"/>

    <FieldSpecification
      name="xconstraint0"
      component="0"
      setNames="{ 991 }"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      scale="1.0"
      functionName="xm"/>

    <FieldSpecification
      name="xconstraint1"
      component="0"
      setNames="{ 992 }"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      scale="1.0"
      functionName="xp"/>

    <FieldSpecification
      name="yconstraint0"
      component="1"
      setNames="{ 993 }"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      scale="1.0"
      functionName="ym"/>

    <FieldSpecification
      name="zconstraint"
      objectPath="nodeManager"
      fieldName="totalDisplacement"
      component="2"
      scale="0.0"
      setNames="{995, 996}"/>

    <Traction
      name="tractionTop"
      objectPath="faceManager"
      tractionType="normal"
      scale="-29497443.75"      
      setNames="{ 994 }"/>

    <FieldSpecification 
      name="initialStress_XX"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/{Underburden Overburden Reservoir}"
      fieldName="rock_stress"
      functionName="pressure"
      component="0"
      scale="-0.9e6"/>

    <FieldSpecification 
      name="initialStress_YY"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/{Underburden Overburden Reservoir}"
      fieldName="rock_stress"
      functionName="pressure"
      component="1"
      scale="-0.9e6"/>

    <FieldSpecification 
      name="initialStress_ZZ"
      initialCondition="1"
      setNames="{ all }"
      objectPath="ElementRegions/{Underburden Overburden Reservoir}"
      fieldName="rock_stress"
      functionName="pressure"
      component="2"
      scale="-0.9e6"/>

    <!--FieldSpecification 
      name="depletion_XX"
      initialCondition="0"
      setNames="{ all }"
      objectPath="ElementRegions/Reservoir"
      fieldName="rock_stress"
      functionName="pressure"
      component="0"
      scale="-0.9e6"/>

    <FieldSpecification 
      name="depletion_YY"
      initialCondition="0"
      setNames="{ all }"
      objectPath="ElementRegions/Reservoir"
      fieldName="rock_stress"
      functionName="pressure"
      component="1"
      scale="-0.9e6"/>

    <FieldSpecification 
      name="depletion_ZZ"
      initialCondition="0"
      setNames="{ all }"
      objectPath="ElementRegions/Reservoir"
      fieldName="rock_stress"
      functionName="pressure"
      component="2"
      scale="-0.9e6"/-->

  </FieldSpecifications>

  <Functions>
    <TableFunction
      name="apertureTable"
      coordinates="{ -1.0e-3, 0.0 }"
      values="{ 1.0e-3, 1.0e-3 }"/>

    <TableFunction
      name="timeFunction"
      inputVarNames="{ time }"
      coordinates="{ 0.0, 100.0 }"
      values="{ 3.5, 1.0 }"/>

    <TableFunction
      name="xm"
      inputVarNames="{ ReferencePosition }"
      coordinateFiles="{ tables/xm_x.geos, tables/x_ylin.geos, tables/zlin.geos }"
      voxelFile="tables/xm.geos"
      interpolation="linear"/>

    <TableFunction
      name="xp"
      inputVarNames="{ ReferencePosition }"
      coordinateFiles="{ tables/xp_x.geos, tables/x_ylin.geos, tables/zlin.geos }"
      voxelFile="tables/xp.geos"
      interpolation="linear"/>

    <TableFunction
      name="ym"
      inputVarNames="{ ReferencePosition }"
      coordinateFiles="{ tables/xlin.geos, tables/ym_y.geos, tables/zlin.geos }"
      voxelFile="tables/ym.geos"
      interpolation="linear"/>

    <TableFunction
      name="pressure0"
      inputVarNames="{ elementCenter }"
      coordinateFiles="{ tables/vertical/x_pres2d.geos, tables/vertical/y_pres2d.geos, tables/zlin.geos }"
      voxelFile="tables/pressure0.geos"
      interpolation="linear"/>

    <TableFunction
      name="pressure"
      inputVarNames="{ elementCenter }"
      coordinateFiles="{ tables/vertical/x_pres2d.geos, tables/vertical/y_pres2d.geos, tables/zlin.geos }"
      voxelFile="tables/vertical/pressure_vertical_25.geos"
      interpolation="linear"/>

  </Functions>

  <Tasks>
    <PackCollection
      name="tractionCollection"
      objectPath="ElementRegions/Fault/faceElementSubRegion"
      fieldName="traction"/>

    <PackCollection
      name="displacementJumpCollection"
      objectPath="ElementRegions/Fault/faceElementSubRegion"
      fieldName="displacementJump"/>   
    </Tasks>

  <Outputs>
    <VTK 
      name="vtkOutput"
      parallelThreads="1"
      plotFileRoot="verticalFault"/>

    <TimeHistory
      name="tractionOutput"
      sources="{/Tasks/tractionCollection}"
      filename="traction_history" />

    <TimeHistory
      name="displacementJumpOutput"
      sources="{/Tasks/displacementJumpCollection}"
      filename="displacementJump_history" /> 
  </Outputs>

  <Events maxTime="100000.0">
    <SoloEvent
      name="preFracture"
      target="/Solvers/SurfaceGen"/>

    <PeriodicEvent
      name="outputs"
      timeFrequency="100000.0"
      target="/Outputs/vtkOutput"/>

    <PeriodicEvent
      name="solverApplications"
      forceDt="100000.0"
      target="/Solvers/poroFractureSolver"/>

    <PeriodicEvent
      name="tractionCollection"      
      target="/Tasks/tractionCollection" />

    <PeriodicEvent
      name="tractionOutput"
      targetExactTimestep="0"
      target="/Outputs/tractionOutput"/>

    <PeriodicEvent
      name="displacementJumpCollection"      
      target="/Tasks/displacementJumpCollection" />

    <PeriodicEvent
      name="displacementJumpOutput"
      targetExactTimestep="0"
      target="/Outputs/displacementJumpOutput"/>    	     
  </Events>

</Problem>
