/*
 * ------------------------------------------------------------------------------------------------------------
 * SPDX-License-Identifier: LGPL-2.1-only
 *
 * Copyright (c) 2018-2020 Lawrence Livermore National Security LLC
 * Copyright (c) 2018-2020 The Board of Trustees of the Leland Stanford Junior University
 * Copyright (c) 2018-2020 TotalEnergies
 * Copyright (c) 2019-     GEOSX Contributors
 * All rights reserved
 *
 * See top level LICENSE, COPYRIGHT, CONTRIBUTORS, NOTICE, and ACKNOWLEDGEMENTS files for details.
 * ------------------------------------------------------------------------------------------------------------
 */

// Source includes
#include "codingUtilities/UnitTestUtilities.hpp"
#include "constitutive/fluid/multifluid/compositional/functions/NegativeTwoPhaseFlash.hpp"
#include "constitutive/fluid/multifluid/compositional/functions/CubicEOSPhaseModel.hpp"

namespace geos
{
namespace testing
{

template< int NC >
using Feed = std::array< real64 const, NC >;

namespace internal
{
template< typename ARRAY, typename LIST >
static void createArray( ARRAY & array, LIST const & data )
{
  for( auto const value : data )
  {
    array.emplace_back( value );
  }
}
}

template< int NC >
struct FluidData
{};

template<>
struct FluidData< 2 >
{
  static void setupFluid( array1d< real64 > & Pc, array1d< real64 > & Tc, array1d< real64 > & omega )
  {
    internal::createArray< array1d< real64 >, Feed< 2 > >( Pc, {73.8e5, 45.99e5} );
    internal::createArray< array1d< real64 >, Feed< 2 > >( Tc, {304.15, 190.55} );
    internal::createArray< array1d< real64 >, Feed< 2 > >( omega, {0.239, 0.0114} );
  }
};

template<>
struct FluidData< 4 >
{
  static void setupFluid( array1d< real64 > & Pc, array1d< real64 > & Tc, array1d< real64 > & omega )
  {
    internal::createArray< array1d< real64 >, Feed< 4 > >( Pc, {134e5, 25.3e5, 14.6e5, 220.5e5} );
    internal::createArray< array1d< real64 >, Feed< 4 > >( Tc, {126.2, 622.0, 782.0, 647.0} );
    internal::createArray< array1d< real64 >, Feed< 4 > >( omega, {0.04, 0.443, 0.816, 0.344} );
  }
};

template< int NC >
using FlashData = std::tuple<
  real64 const,       // pressure
  real64 const,       // temperature
  Feed< NC > const,   // total composition
  bool,               // expected flash status (success/failure)
  real64 const,       // expected vapour fraction
  Feed< NC > const,   // expected liquid composition
  Feed< NC > const    // expected vapour composition
  >;

template< int NC, typename EOS_TYPE >
class NegativeTwoPhaseFlashTestFixture :  public ::testing::TestWithParam< FlashData< NC > >
{
  static constexpr real64 relTol = 1.0e-5;
  static constexpr real64 absTol = 1.0e-7;
  static constexpr int numComps = NC;
public:
  NegativeTwoPhaseFlashTestFixture(): binaryInteractionCoefficients( 0.0 )
  {
    FluidData< NC >::setupFluid( criticalPressure, criticalTemperature, acentricFactor );
  }

  ~NegativeTwoPhaseFlashTestFixture() = default;

  void testFlash( FlashData< NC > const & data )
  {
    real64 const pressure = std::get< 0 >( data );
    real64 const temperature = std::get< 1 >( data );
    array1d< real64 > composition;
    internal::createArray( composition, std::get< 2 >( data ));

    bool const expectedStatus = std::get< 3 >( data );
    real64 const expectedVapourFraction = std::get< 4 >( data );

    stackArray1d< real64, NC > expectedLiquidComposition;
    internal::createArray( expectedLiquidComposition, std::get< 5 >( data ));
    stackArray1d< real64, NC > expectedVapourComposition;
    internal::createArray( expectedVapourComposition, std::get< 6 >( data ));

    real64 vapourFraction = -1.0;
    array1d< real64 > liquidComposition( numComps );
    array1d< real64 > vapourComposition( numComps );

    bool status = constitutive::NegativeTwoPhaseFlash< EOS_TYPE, EOS_TYPE >::compute(
      numComps,
      pressure,
      temperature,
      composition,
      criticalPressure,
      criticalTemperature,
      acentricFactor,
      binaryInteractionCoefficients,
      vapourFraction,
      liquidComposition,
      vapourComposition );

    // Check the flash success result
    ASSERT_EQ( expectedStatus, status );

    if( !expectedStatus )
    {
      return;
    }

    // Check the vaopur fraction
    checkRelativeError( expectedVapourFraction, vapourFraction, relTol, absTol );

    // Check liquid composition
    if( expectedVapourFraction < 1.0 - absTol )
    {
      for( integer ic=0; ic<numComps; ++ic )
      {
        checkRelativeError( expectedLiquidComposition[ic], liquidComposition[ic], relTol, absTol );
      }
    }

    // Check vapour composition
    if( absTol < expectedVapourFraction )
    {
      for( integer ic=0; ic<numComps; ++ic )
      {
        checkRelativeError( expectedVapourComposition[ic], vapourComposition[ic], relTol, absTol );
      }
    }
  }

protected:
  array1d< real64 > criticalPressure;
  array1d< real64 > criticalTemperature;
  array1d< real64 > acentricFactor;
  real64 const binaryInteractionCoefficients;
};

using NegativeTwoPhaseFlash2CompPR = NegativeTwoPhaseFlashTestFixture< 2, constitutive::PengRobinsonEOS >;
using NegativeTwoPhaseFlash2CompSRK = NegativeTwoPhaseFlashTestFixture< 2, constitutive::SoaveRedlichKwongEOS >;
using NegativeTwoPhaseFlash4CompPR = NegativeTwoPhaseFlashTestFixture< 4, constitutive::PengRobinsonEOS >;
using NegativeTwoPhaseFlash4CompSRK = NegativeTwoPhaseFlashTestFixture< 4, constitutive::SoaveRedlichKwongEOS >;

TEST_P( NegativeTwoPhaseFlash2CompPR, testNegativeFlash )
{
  testFlash( GetParam());
}

TEST_P( NegativeTwoPhaseFlash2CompSRK, testNegativeFlash )
{
  testFlash( GetParam());
}

TEST_P( NegativeTwoPhaseFlash4CompPR, testNegativeFlash )
{
  testFlash( GetParam());
}

TEST_P( NegativeTwoPhaseFlash4CompSRK, testNegativeFlash )
{
  testFlash( GetParam());
}

//-------------------------------------------------------------------------------
// Data generated by PVTPackage
//-------------------------------------------------------------------------------
INSTANTIATE_TEST_SUITE_P(
  NegativeTwoPhaseFlash2CompPRTest,
  NegativeTwoPhaseFlash2CompPR,
  ::testing::Values(
    FlashData< 2 >( 1.00000e+05, 1.23150e+02, {0.10000000, 0.90000000}, true, 0.89046781, {0.89640402, 0.10359598}, {0.00203815, 0.99796185} ),
    FlashData< 2 >( 1.00000e+05, 1.23150e+02, {0.75000000, 0.25000000}, true, 0.16369589, {0.89640402, 0.10359598}, {0.00203815, 0.99796185} ),
    FlashData< 2 >( 1.00000e+05, 1.23150e+02, {0.50000000, 0.50000000}, true, 0.44322355, {0.89640402, 0.10359598}, {0.00203815, 0.99796185} ),
    FlashData< 2 >( 1.00000e+05, 1.23150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.00203815, 0.99796185} ),
    FlashData< 2 >( 1.01325e+05, 1.23150e+02, {0.10000000, 0.90000000}, true, 0.89019683, {0.89442515, 0.10557485}, {0.00200999, 0.99799001} ),
    FlashData< 2 >( 1.01325e+05, 1.23150e+02, {0.75000000, 0.25000000}, true, 0.16183628, {0.89442515, 0.10557485}, {0.00200999, 0.99799001} ),
    FlashData< 2 >( 1.01325e+05, 1.23150e+02, {0.50000000, 0.50000000}, true, 0.44197495, {0.89442515, 0.10557485}, {0.00200999, 0.99799001} ),
    FlashData< 2 >( 1.01325e+05, 1.23150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.00200999, 0.99799001} ),
    FlashData< 2 >( 1.00000e+05, 1.93150e+02, {0.10000000, 0.90000000}, true, 1.00000000, {0.10000000, 0.90000000}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 1.00000e+05, 1.93150e+02, {0.75000000, 0.25000000}, true, 1.00000000, {0.75000000, 0.25000000}, {0.75000000, 0.25000000} ),
    FlashData< 2 >( 1.00000e+06, 1.93150e+02, {0.10000000, 0.90000000}, true, 1.00000000, {0.88652519, 0.11347481}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 1.00000e+06, 1.93150e+02, {0.75000000, 0.25000000}, true, 0.18963700, {0.88652519, 0.11347481}, {0.16659612, 0.83340388} ),
    FlashData< 2 >( 1.00000e+06, 1.93150e+02, {0.50000000, 0.50000000}, true, 0.53689343, {0.88652519, 0.11347481}, {0.16659612, 0.83340388} ),
    FlashData< 2 >( 1.00000e+06, 1.93150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.16659612, 0.83340388} ),
    FlashData< 2 >( 1.00000e+08, 1.93150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} ),
    FlashData< 2 >( 1.00000e+05, 2.77150e+02, {0.10000000, 0.90000000}, true, 1.00000000, {0.10000000, 0.90000000}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 5.00000e+06, 2.77150e+02, {0.50000000, 0.50000000}, true, 1.00000000, {0.93120642, 0.06879358}, {0.50000000, 0.50000000} ),
    FlashData< 2 >( 5.00000e+06, 2.77150e+02, {0.90000000, 0.10000000}, true, 0.27198870, {0.93120642, 0.06879358}, {0.81647218, 0.18352782} ),
    FlashData< 2 >( 1.00000e+07, 2.77150e+02, {0.10000000, 0.90000000}, true, 1.00000000, {0.55736440, 0.44263560}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 1.00000e+07, 2.77150e+02, {0.75000000, 0.25000000}, true, 0.00000000, {0.75000000, 0.25000000}, {0.55736437, 0.44263563} ),
    FlashData< 2 >( 1.00000e+08, 3.33150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} ),
    FlashData< 2 >( 1.00000e+05, 3.73150e+02, {0.10000000, 0.90000000}, true, 1.00000000, {0.10000000, 0.90000000}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 5.00000e+06, 3.73150e+02, {0.90000000, 0.10000000}, true, 1.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} ),
    FlashData< 2 >( 1.00000e+07, 3.73150e+02, {0.90000000, 0.10000000}, true, 1.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} ),
    FlashData< 2 >( 1.00000e+08, 3.73150e+02, {0.10000000, 0.90000000}, true, 0.00000000, {0.10000000, 0.90000000}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 1.00000e+08, 3.73150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} )
    )
  );

INSTANTIATE_TEST_SUITE_P(
  NegativeTwoPhaseFlash2CompSRK,
  NegativeTwoPhaseFlash2CompSRK,
  ::testing::Values(
    FlashData< 2 >( 1.00000e+05, 1.23150e+02, {0.10000000, 0.90000000}, true, 0.89119844, {0.90499542, 0.09500458}, {0.00172250, 0.99827750} ),
    FlashData< 2 >( 1.00000e+05, 1.23150e+02, {0.75000000, 0.25000000}, true, 0.17159312, {0.90499542, 0.09500458}, {0.00172250, 0.99827750} ),
    FlashData< 2 >( 1.00000e+05, 1.23150e+02, {0.50000000, 0.50000000}, true, 0.44836440, {0.90499542, 0.09500458}, {0.00172250, 0.99827750} ),
    FlashData< 2 >( 1.00000e+05, 1.23150e+02, {0.90000000, 0.10000000}, true, 0.00553035, {0.90499542, 0.09500458}, {0.00172250, 0.99827750} ),
    FlashData< 2 >( 1.01325e+05, 1.23150e+02, {0.10000000, 0.90000000}, true, 0.89095865, {0.90320173, 0.09679827}, {0.00169892, 0.99830108} ),
    FlashData< 2 >( 1.01325e+05, 1.23150e+02, {0.75000000, 0.25000000}, true, 0.16994038, {0.90320173, 0.09679827}, {0.00169892, 0.99830108} ),
    FlashData< 2 >( 1.01325e+05, 1.23150e+02, {0.50000000, 0.50000000}, true, 0.44725510, {0.90320173, 0.09679827}, {0.00169892, 0.99830108} ),
    FlashData< 2 >( 1.01325e+05, 1.23150e+02, {0.90000000, 0.10000000}, true, 0.00355155, {0.90320173, 0.09679827}, {0.00169892, 0.99830108} ),
    FlashData< 2 >( 1.00000e+06, 1.23150e+02, {0.10000000, 0.90000000}, true, 0.00000000, {0.10000000, 0.90000000}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 1.00000e+06, 1.23150e+02, {0.50000000, 0.50000000}, false, 0.00000000, {0.50000000, 0.50000000}, {0.49940700, 0.50059300} ),
    FlashData< 2 >( 1.00000e+06, 1.23150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} ),
    FlashData< 2 >( 5.00000e+06, 1.23150e+02, {0.75000000, 0.25000000}, true, 0.00000000, {0.75000000, 0.25000000}, {0.74999999, 0.25000001} ),
    FlashData< 2 >( 5.00000e+06, 1.23150e+02, {0.50000000, 0.50000000}, false, 0.00000000, {0.50000000, 0.50000000}, {0.49976128, 0.50023872} ),
    FlashData< 2 >( 5.00000e+06, 1.23150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} ),
    FlashData< 2 >( 1.00000e+08, 1.23150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} ),
    FlashData< 2 >( 1.00000e+05, 1.93150e+02, {0.10000000, 0.90000000}, true, 1.00000000, {0.10000000, 0.90000000}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 1.00000e+05, 1.93150e+02, {0.75000000, 0.25000000}, true, 1.00000000, {0.75000000, 0.25000000}, {0.75000000, 0.25000000} ),
    FlashData< 2 >( 1.00000e+06, 1.93150e+02, {0.10000000, 0.90000000}, true, 1.00000000, {0.89321654, 0.10678346}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 1.00000e+06, 1.93150e+02, {0.75000000, 0.25000000}, true, 0.19674494, {0.89321654, 0.10678346}, {0.16528655, 0.83471345} ),
    FlashData< 2 >( 1.00000e+06, 1.93150e+02, {0.50000000, 0.50000000}, true, 0.54018456, {0.89321654, 0.10678346}, {0.16528655, 0.83471345} ),
    FlashData< 2 >( 1.00000e+06, 1.93150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.16528655, 0.83471345} ),
    FlashData< 2 >( 1.00000e+08, 1.93150e+02, {0.50000000, 0.50000000}, true, 0.00000000, {0.50000000, 0.50000000}, {0.49999999, 0.50000001} ),
    FlashData< 2 >( 1.00000e+08, 1.93150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} ),
    FlashData< 2 >( 1.00000e+05, 2.77150e+02, {0.10000000, 0.90000000}, true, 1.00000000, {0.10000000, 0.90000000}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 1.00000e+05, 2.77150e+02, {0.90000000, 0.10000000}, true, 1.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} ),
    FlashData< 2 >( 5.00000e+06, 2.77150e+02, {0.50000000, 0.50000000}, true, 1.00000000, {0.93367368, 0.06632632}, {0.50000000, 0.50000000} ),
    FlashData< 2 >( 5.00000e+06, 2.77150e+02, {0.90000000, 0.10000000}, true, 0.29977608, {0.93367368, 0.06632632}, {0.82134425, 0.17865575} ),
    FlashData< 2 >( 1.00000e+07, 2.77150e+02, {0.10000000, 0.90000000}, true, 1.00000000, {0.55602808, 0.44397192}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 1.00000e+07, 2.77150e+02, {0.50000000, 0.50000000}, true, 1.00000000, {0.55602813, 0.44397187}, {0.50000000, 0.50000000} ),
    FlashData< 2 >( 1.00000e+07, 2.77150e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.55602810, 0.44397190} ),
    FlashData< 2 >( 1.00000e+07, 2.88650e+02, {0.10000000, 0.90000000}, true, 1.00000000, {0.66044007, 0.33955993}, {0.10000000, 0.90000000} ),
    FlashData< 2 >( 1.00000e+07, 2.88650e+02, {0.75000000, 0.25000000}, true, 0.00000000, {0.75000000, 0.25000000}, {0.66044003, 0.33955997} ),
    FlashData< 2 >( 1.00000e+07, 2.88650e+02, {0.50000000, 0.50000000}, true, 1.00000000, {0.66044004, 0.33955996}, {0.50000000, 0.50000000} ),
    FlashData< 2 >( 1.00000e+07, 2.88650e+02, {0.90000000, 0.10000000}, true, 0.00000000, {0.90000000, 0.10000000}, {0.66044004, 0.33955996} ),
    FlashData< 2 >( 1.00000e+07, 3.73150e+02, {0.90000000, 0.10000000}, true, 1.00000000, {0.90000000, 0.10000000}, {0.90000000, 0.10000000} ),
    FlashData< 2 >( 1.00000e+08, 3.73150e+02, {0.10000000, 0.90000000}, true, 0.00000000, {0.10000000, 0.90000000}, {0.10000000, 0.90000000} )
    )
  );

INSTANTIATE_TEST_SUITE_P(
  NegativeTwoPhaseFlash4CompPRTest,
  NegativeTwoPhaseFlash4CompPR,
  ::testing::Values(
    FlashData< 4 >( 1.00000e+05, 1.93150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.05494732, {0.00212953, 0.11091233, 0.11091657, 0.77604157},
                    {0.99983915, 0.00000004, 0.00000000, 0.00016081} ),
    FlashData< 4 >( 1.00000e+05, 1.93150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.15509117, {0.00224037, 0.12405835, 0.12406309, 0.74963819},
                    {0.99978671, 0.00000003, 0.00000000, 0.00021326} ),
    FlashData< 4 >( 5.00000e+06, 1.93150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.00000000, {0.05695100, 0.10481800, 0.10482200, 0.73340900},
                    {0.99999403, 0.00000001, 0.00000000, 0.00000596} ),
    FlashData< 4 >( 5.00000e+06, 1.93150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.05805540, {0.10499137, 0.11127831, 0.11128255, 0.67244777},
                    {0.99999214, 0.00000000, 0.00000000, 0.00000786} ),
    FlashData< 4 >( 5.00000e+06, 1.93150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.79032837, {0.00000000, 0.49991503, 0.49993411, 0.00015087},
                    {0.00000000, 0.00000000, 0.00000000, 1.00000000} ),
    FlashData< 4 >( 5.00000e+06, 1.93150e+02, {0.10481800, 0.00000000, 0.10482200, 0.79036000}, true, 0.02270849, {0.08401748, 0.00000000, 0.10725766, 0.80872486},
                    {0.99999745, 0.00000000, 0.00000000, 0.00000255} ),
    FlashData< 4 >( 1.00000e+07, 1.93150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.00000000, {0.15695100, 0.10481800, 0.10482200, 0.63340900},
                    {0.99999253, 0.00000001, 0.00000000, 0.00000746} ),
    FlashData< 4 >( 1.00000e+08, 1.93150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.26026563, {0.00859000, 0.00000000, 0.00000000, 0.99141000},
                    {0.19440401, 0.40273470, 0.40275006, 0.00011123} ),
    FlashData< 4 >( 1.00000e+06, 2.77150e+02, {0.10481800, 0.00000000, 0.10482200, 0.79036000}, true, 0.09709629, {0.00948550, 0.00000000, 0.11609432, 0.87442018},
                    {0.99132012, 0.00000000, 0.00000006, 0.00867982} ),
    FlashData< 4 >( 1.00000e+06, 2.77150e+02, {0.99000000, 0.00000000, 0.00000000, 0.01000000}, true, 0.99067660, {0.00093634, 0.00000000, 0.00000000, 0.99906366},
                    {0.99930822, 0.00000000, 0.00000000, 0.00069178} ),
    FlashData< 4 >( 5.00000e+06, 2.77150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.00099725, {0.05601273, 0.10492262, 0.10492664, 0.73413801},
                    {0.99686599, 0.00001030, 0.00000000, 0.00312371} ),
    FlashData< 4 >( 5.00000e+06, 2.77150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.10433080, {0.05916328, 0.11702657, 0.11703205, 0.70677810},
                    {0.99644852, 0.00000868, 0.00000000, 0.00354280} ),
    FlashData< 4 >( 5.00000e+06, 2.77150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.78833888, {0.00000000, 0.49521612, 0.49523502, 0.00954887},
                    {0.00000000, 0.00000000, 0.00000000, 1.00000000} ),
    FlashData< 4 >( 5.00000e+06, 2.77150e+02, {0.01000000, 0.00000000, 0.00000000, 0.99000000}, true, 0.00542040, {0.00460549, 0.00000000, 0.00000000, 0.99539451},
                    {0.99982895, 0.00000000, 0.00000000, 0.00017105} ),
    FlashData< 4 >( 1.00000e+07, 2.77150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.00000000, {0.05695100, 0.10481800, 0.10482200, 0.73340900},
                    {0.99799724, 0.00001036, 0.00000000, 0.00199239} ),
    FlashData< 4 >( 1.00000e+07, 2.77150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.04815081, {0.11441848, 0.11011994, 0.11012459, 0.66533699},
                    {0.99773725, 0.00000878, 0.00000000, 0.00225397} ),
    FlashData< 4 >( 1.00000e+07, 2.77150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.78838676, {0.00000000, 0.49532818, 0.49534708, 0.00932474},
                    {0.00000000, 0.00000000, 0.00000000, 1.00000000} ),
    FlashData< 4 >( 1.00000e+05, 2.88650e+02, {0.99000000, 0.00000000, 0.00000000, 0.01000000}, true, 1.00000000, {0.00009419, 0.00000000, 0.00000000, 0.99990581},
                    {0.99000000, 0.00000000, 0.00000000, 0.01000000} ),
    FlashData< 4 >( 1.00000e+05, 2.88650e+02, {0.01000000, 0.00000000, 0.00000000, 0.99000000}, true, 0.01005463, {0.00009419, 0.00000000, 0.00000000, 0.99990581},
                    {0.98529369, 0.00000000, 0.00000000, 0.01470631} ),
    FlashData< 4 >( 1.00000e+07, 2.88650e+02, {0.99000000, 0.00000000, 0.00000000, 0.01000000}, true, 0.99014150, {0.00920628, 0.00000000, 0.00000000, 0.99079372},
                    {0.99976543, 0.00000000, 0.00000000, 0.00023457} ),
    FlashData< 4 >( 1.00000e+07, 2.88650e+02, {0.01000000, 0.00000000, 0.00000000, 0.99000000}, true, 0.00080128, {0.00920628, 0.00000000, 0.00000000, 0.99079372},
                    {0.99976543, 0.00000000, 0.00000000, 0.00023457} ),
    FlashData< 4 >( 1.00000e+08, 2.88650e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.00000000, {0.05695100, 0.10481800, 0.10482200, 0.73340900},
                    {0.99074051, 0.00151780, 0.00036622, 0.00737546} ),
    FlashData< 4 >( 1.00000e+05, 3.33150e+02, {0.10481800, 0.00000000, 0.10482200, 0.79036000}, true, 0.80265488, {0.42986131, 0.00000000, 0.53116084, 0.03897785},
                    {0.02490107, 0.00000000, 0.00000000, 0.97509893} ),
    FlashData< 4 >( 1.00000e+05, 3.33150e+02, {0.99000000, 0.00000000, 0.00000000, 0.01000000}, true, 1.00000000, {0.00008544, 0.00000000, 0.00000000, 0.99991456},
                    {0.99000000, 0.00000000, 0.00000000, 0.01000000} ),
    FlashData< 4 >( 1.00000e+05, 3.33150e+02, {0.01000000, 0.00000000, 0.00000000, 0.99000000}, true, 0.01211595, {0.00008544, 0.00000000, 0.00000000, 0.99991456},
                    {0.81839204, 0.00000000, 0.00000000, 0.18160796} ),
    FlashData< 4 >( 1.00000e+07, 3.73150e+02, {0.99000000, 0.00000000, 0.00000000, 0.01000000}, true, 1.00000000, {0.01124728, 0.00000000, 0.00000000, 0.98875272},
                    {0.99000000, 0.00000000, 0.00000000, 0.01000000} ),
    FlashData< 4 >( 1.00000e+08, 3.73150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.00000000, {0.15695100, 0.10481800, 0.10482200, 0.63340900},
                    {0.96743775, 0.00258765, 0.00040557, 0.02956903} ),
    FlashData< 4 >( 1.00000e+08, 3.73150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.77592410, {0.00000000, 0.46777900, 0.46779685, 0.06442416},
                    {0.00000000, 0.00000000, 0.00000000, 1.00000000} ),
    FlashData< 4 >( 1.01325e+05, 4.73150e+02, {0.10481800, 0.00000000, 0.10482200, 0.79036000}, true, 0.91045552, {0.00021326, 0.00000000, 0.97656017, 0.02322657},
                    {0.11510601, 0.00000000, 0.01908542, 0.86580857} ),
    FlashData< 4 >( 1.01325e+05, 4.73150e+02, {0.01000000, 0.00000000, 0.00000000, 0.99000000}, true, 1.00000000, {0.01000000, 0.00000000, 0.00000000, 0.99000000},
                    {0.01000000, 0.00000000, 0.00000000, 0.99000000} ),
    FlashData< 4 >( 5.00000e+06, 4.73150e+02, {0.01000000, 0.00000000, 0.00000000, 0.99000000}, true, 0.00667036, {0.00564268, 0.00000000, 0.00000000, 0.99435732},
                    {0.65887896, 0.00000000, 0.00000000, 0.34112104} ),
    FlashData< 4 >( 1.00000e+07, 4.73150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.00000000, {0.05695100, 0.10481800, 0.10482200, 0.73340900},
                    {0.63657505, 0.00844935, 0.00032819, 0.35464741} ),
    FlashData< 4 >( 1.00000e+07, 4.73150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.11598703, {0.09285299, 0.11735787, 0.11853215, 0.67125698},
                    {0.64548387, 0.00924342, 0.00032795, 0.34494476} ),
    FlashData< 4 >( 1.00000e+07, 4.73150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.66978458, {0.00000000, 0.31742202, 0.31743521, 0.36514277},
                    {0.00000000, 0.00000053, 0.00000000, 0.99999947} ),
    FlashData< 4 >( 1.00000e+07, 4.73150e+02, {0.10481800, 0.00000000, 0.10482200, 0.79036000}, true, 0.05671060, {0.07334091, 0.00000000, 0.11109102, 0.81556807},
                    {0.62838857, 0.00000000, 0.00054702, 0.37106441} ),
    FlashData< 4 >( 1.00000e+07, 4.73150e+02, {0.01000000, 0.00000000, 0.00000000, 0.99000000}, true, 0.00000000, {0.01000000, 0.00000000, 0.00000000, 0.99000000},
                    {0.81623091, 0.00000000, 0.00000000, 0.18376909} ),
    FlashData< 4 >( 1.00000e+08, 4.73150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, false, 0.00000000, {0.05695100, 0.10481800, 0.10482200, 0.73340900},
                    {0.86194465, 0.01093360, 0.00479657, 0.12232518} ),
    FlashData< 4 >( 1.00000e+08, 4.73150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, false, 0.00000000, {0.15695100, 0.10481800, 0.10482200, 0.63340900},
                    {0.86753692, 0.01159006, 0.00497879, 0.11589423} ),
    FlashData< 4 >( 1.00000e+08, 4.73150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.72801768, {0.00000000, 0.38538472, 0.38540005, 0.22921523},
                    {0.00000000, 0.00000023, 0.00000000, 0.99999977} ),
    FlashData< 4 >( 1.00000e+08, 4.73150e+02, {0.10481800, 0.00000000, 0.10482200, 0.79036000}, true, 0.00000000, {0.10481800, 0.00000000, 0.10482200, 0.79036000},
                    {0.87525696, 0.00000000, 0.00442795, 0.12031509} )
    )
  );

INSTANTIATE_TEST_SUITE_P(
  NegativeTwoPhaseFlash4CompSRKTest,
  NegativeTwoPhaseFlash4CompSRK,
  ::testing::Values(
    FlashData< 4 >( 1.00000e+05, 1.93150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.05500889, {0.00206131, 0.11091956, 0.11092380, 0.77609534},
                    {0.99989436, 0.00000003, 0.00000000, 0.00010562} ),
    FlashData< 4 >( 1.00000e+05, 1.93150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.15512653, {0.00218530, 0.12406354, 0.12406828, 0.74968288},
                    {0.99985931, 0.00000002, 0.00000000, 0.00014067} ),
    FlashData< 4 >( 1.00000e+05, 1.93150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.79033121, {0.00000000, 0.49992180, 0.49994088, 0.00013733},
                    {0.00000000, 0.00000000, 0.00000000, 1.00000000} ),
    FlashData< 4 >( 1.00000e+05, 1.93150e+02, {0.10481800, 0.00000000, 0.10482200, 0.79036000}, true, 0.10331395, {0.00168236, 0.00000000, 0.11689933, 0.88141830},
                    {0.99995639, 0.00000000, 0.00000000, 0.00004361} ),
    FlashData< 4 >( 5.00000e+06, 1.93150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.00000000, {0.05695100, 0.10481800, 0.10482200, 0.73340900},
                    {0.99999616, 0.00000000, 0.00000000, 0.00000384} ),
    FlashData< 4 >( 5.00000e+06, 1.93150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.06045530, {0.10270508, 0.11156255, 0.11156680, 0.67416557},
                    {0.99999492, 0.00000000, 0.00000000, 0.00000508} ),
    FlashData< 4 >( 1.00000e+05, 2.77150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.17706930, {0.00109567, 0.12733462, 0.12737646, 0.74419325},
                    {0.88128965, 0.00017185, 0.00000000, 0.11853850} ),
    FlashData< 4 >( 1.00000e+05, 2.77150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.78822635, {0.00000000, 0.49495299, 0.49497188, 0.01007514},
                    {0.00000000, 0.00000000, 0.00000000, 1.00000000} ),
    FlashData< 4 >( 1.00000e+05, 2.77150e+02, {0.10481800, 0.00000000, 0.10482200, 0.79036000}, true, 0.11180967, {0.00087410, 0.00000000, 0.11801747, 0.88110843},
                    {0.93052444, 0.00000000, 0.00000025, 0.06947531} ),
    FlashData< 4 >( 1.00000e+08, 2.77150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.00000000, {0.05695100, 0.10481800, 0.10482200, 0.73340900},
                    {0.99474278, 0.00098222, 0.00018141, 0.00409360} ),
    FlashData< 4 >( 1.00000e+08, 2.77150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.00000000, {0.15695100, 0.10481800, 0.10482200, 0.63340900},
                    {0.99457965, 0.00087575, 0.00011764, 0.00442696} ),
    FlashData< 4 >( 1.00000e+08, 2.77150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.78896344, {0.00000000, 0.49668171, 0.49670067, 0.00661762},
                    {0.00000000, 0.00000000, 0.00000000, 1.00000000} ),
    FlashData< 4 >( 1.01325e+05, 2.88650e+02, {0.99000000, 0.00000000, 0.00000000, 0.01000000}, true, 1.00000000, {0.00007888, 0.00000000, 0.00000000, 0.99992112},
                    {0.99000000, 0.00000000, 0.00000000, 0.01000000} ),
    FlashData< 4 >( 1.00000e+06, 2.88650e+02, {0.99000000, 0.00000000, 0.00000000, 0.01000000}, true, 0.99130326, {0.00078490, 0.00000000, 0.00000000, 0.99921510},
                    {0.99867842, 0.00000000, 0.00000000, 0.00132158} ),
    FlashData< 4 >( 1.00000e+06, 2.88650e+02, {0.01000000, 0.00000000, 0.00000000, 0.99000000}, true, 0.00923455, {0.00078490, 0.00000000, 0.00000000, 0.99921510},
                    {0.99867842, 0.00000000, 0.00000000, 0.00132158} ),
    FlashData< 4 >( 5.00000e+06, 2.88650e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.00340534, {0.05374401, 0.10517610, 0.10518017, 0.73589971},
                    {0.99549808, 0.00001636, 0.00000000, 0.00448556} ),
    FlashData< 4 >( 1.00000e+07, 2.98150e+02, {0.05695100, 0.10481800, 0.10482200, 0.73340900}, true, 0.00000000, {0.05695100, 0.10481800, 0.10482200, 0.73340900},
                    {0.99583231, 0.00002343, 0.00000001, 0.00414425} ),
    FlashData< 4 >( 1.00000e+07, 2.98150e+02, {0.15695100, 0.10481800, 0.10482200, 0.63340900}, true, 0.05486433, {0.10827951, 0.11090140, 0.11090683, 0.66991227},
                    {0.99540406, 0.00002069, 0.00000001, 0.00457524} ),
    FlashData< 4 >( 1.00000e+07, 2.98150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.78640424, {0.00000000, 0.49073071, 0.49074943, 0.01851986},
                    {0.00000000, 0.00000000, 0.00000000, 1.00000000} ),
    FlashData< 4 >( 1.00000e+05, 3.33150e+02, {0.99000000, 0.00000000, 0.00000000, 0.01000000}, true, 1.00000000, {0.00007479, 0.00000000, 0.00000000, 0.99992521},
                    {0.99000000, 0.00000000, 0.00000000, 0.01000000} ),
    FlashData< 4 >( 1.00000e+08, 4.73150e+02, {0.00000000, 0.10481800, 0.10482200, 0.79036000}, true, 0.72419599, {0.00000000, 0.38004425, 0.38005974, 0.23989601},
                    {0.00000000, 0.00000038, 0.00000000, 0.99999962} ),
    FlashData< 4 >( 1.00000e+08, 4.73150e+02, {0.10481800, 0.00000000, 0.10482200, 0.79036000}, true, 0.00000000, {0.10481800, 0.00000000, 0.10482200, 0.79036000},
                    {0.91096406, 0.00000000, 0.00149697, 0.08753897} ),
    FlashData< 4 >( 1.00000e+08, 4.73150e+02, {0.99000000, 0.00000000, 0.00000000, 0.01000000}, true, 1.00000000, {0.13302875, 0.00000000, 0.00000000, 0.86697125},
                    {0.99000000, 0.00000000, 0.00000000, 0.01000000} ),
    FlashData< 4 >( 1.00000e+08, 4.73150e+02, {0.01000000, 0.00000000, 0.00000000, 0.99000000}, true, 0.00000000, {0.01000000, 0.00000000, 0.00000000, 0.99000000},
                    {0.95815027, 0.00000000, 0.00000000, 0.04184973} )
    )
  );

} // testing

} // geos
