language: cpp
env:
  global:
  - OMP_NUM_THREADS=3
  - DO_BUILD=yes
  - DO_TEST=yes
matrix:
  include:
  - compiler: gcc7-ubuntu18
    sudo: required
    services: docker
    dist: trusty
    env:
    - IMG=gcc7-ubuntu18
    - CMAKE_EXTRA_FLAGS="-DENABLE_WARNINGS=On -DENABLE_TBB=On -DBLT_CXX_STD=c++14 -DENABLE_WARNINGS_AS_ERRORS=ON"
  - compiler: gcc8-ubuntu18
    sudo: required
    services: docker
    dist: trusty
    env:
    - IMG=gcc8-ubuntu18
    - CMAKE_EXTRA_FLAGS="-DENABLE_WARNINGS=On -DENABLE_TBB=On -DBLT_CXX_STD=c++14 -DENABLE_WARNINGS_AS_ERRORS=ON"
  - compiler: clang6-LC-toss3
    sudo: required
    services: docker
    dist: trusty
    env:
    - IMG=clang6-LC-toss3
    - CMAKE_EXTRA_FLAGS="-DENABLE_WARNINGS=On -DENABLE_TBB=On -DBLT_CXX_STD=c++14 -DENABLE_WARNINGS_AS_ERRORS=ON"
  - compiler: clang7-LC-toss3
    sudo: required
    services: docker
    dist: trusty
    env:
    - IMG=clang7-LC-toss3
    - CMAKE_EXTRA_FLAGS="-DENABLE_WARNINGS=On -DENABLE_TBB=On -DBLT_CXX_STD=c++14 -DENABLE_WARNINGS_AS_ERRORS=ON"
  - os: osx
    osx_image: xcode10
script: 
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      ls;
    else
      docker run --rm --user='root' -v ${TRAVIS_BUILD_DIR}:/home/geosx/geosx_repo geosx/compiler:$IMG  chown -R geosx /home/geosx;
      docker run --rm -v ${TRAVIS_BUILD_DIR}:/home/geosx/geosx_repo  -e DO_BUILD -e DO_TEST -e CMAKE_EXTRA_FLAGS -e PATHMOD  geosx/compiler:$IMG  /home/geosx/geosx_repo/scripts/travis_build_and_test.sh;    
    fi

#- docker run --rm --user='root' -v ${TRAVIS_BUILD_DIR}:/home/geosx/geosx_repo geosx/compiler:$IMG  chown -R geosx /home/geosx
#- docker run --rm -v ${TRAVIS_BUILD_DIR}:/home/geosx/geosx_repo  -e DO_BUILD -e DO_TEST -e CMAKE_EXTRA_FLAGS -e PATHMOD  geosx/compiler:$IMG  /home/geosx/geosx_repo/scripts/travis_build_and_test.sh
